{"version":3,"sources":["bundle.js"],"names":["UIPlanning","selector","options","this","_domEl","$","addClass","_containerEl","find","_controlsEl","_feedbackEl","_options","Object","assign","hourFrom","hourTo","hourParts","dayNames","stateDefault","states","_state","_rangesRenderLock","_callbacks","model_setState","bind","ux_releaseHover","ux_columnState","ux_columnHover","ux_rowState","ux_rowHover","ux_blockState","ux_blockStateMouseState","dom_build","_allBlocks","ux_interactions","planning","model_restore","dom_setBlocksState","dom_renderRanges","prototype","on","ux_displayError","message","html","e","button","type","document","target","is","off","removeClass","ux_rowSelect","closest","ux_columnSelect","index","selectors","el","i","iLen","push","join","blocks","state","length","attr","uid","console","log","str","ranges","iRange","iRangeLen","range","self","remove","model_retrieveRanges","start","end","tipEl","css","width","endBlock","offset","left","startBlock","appendTo","background-color","color","a","startIndex","endIndex","_cells","day","iDay","classes","dayCells","iHour","iHourMod","iHourLen","label","append","Math","ceil","each","rowIndex","rowEl","blockIndex","blockEl","model_retrieveState","input","hasOwnProperty","filter","trigger","rowDay","iCell","iCellLen","p","s","_convertHourToIndex","model_export","settings","JSON","stringify","week","iRow","iRowLen","row","iBlock","iBlockLen","block","rowRanges","outRange","out","_convertIndexToHour","tokens","split","h","parseInt","m","floor","toString"],"mappings":"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","file":"../bundle.js","sourcesContent":["var UIPlanning = function (selector, options) {\r\n\r\n\tthis._domEl = $(selector);\r\n\tthis._domEl.addClass('gv-planning');\r\n\r\n\tthis._containerEl = this._domEl.find('.planning-container');\r\n\tthis._controlsEl = this._domEl.find('.planning-controls');\r\n\tthis._feedbackEl = this._domEl.find('.planning-feedback');\r\n\r\n\tthis._options = Object.assign({\r\n\t\thourFrom: 0,\r\n\t\thourTo: 24,\r\n\t\thourParts: 4,\r\n\t\tdayNames: ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'],\r\n\t\tstateDefault: null,\r\n\t\tstates: []\r\n\t}, options);\r\n\r\n\tthis._state = null;\r\n\t/** @var boolean   allow developper to lock rendering during extensive update processes */\r\n\tthis._rangesRenderLock = true;\r\n\r\n\tthis._callbacks = {\r\n\t\tmodel_setState: this.model_setState.bind(this),\r\n\t\tux_releaseHover: this.ux_releaseHover.bind(this),\r\n\t\tux_columnState: this.ux_columnState.bind(this),\r\n\t\tux_columnHover: this.ux_columnHover.bind(this),\r\n\t\tux_rowState: this.ux_rowState.bind(this),\r\n\t\tux_rowHover: this.ux_rowHover.bind(this),\r\n\t\tux_blockState: this.ux_blockState.bind(this),\r\n\t\tux_blockStateMouseState: this.ux_blockStateMouseState.bind(this),\r\n\t};\r\n\t\r\n\t// ############## init\r\n\r\n\tthis.dom_build();\r\n\tthis._allBlocks = this._containerEl.find('.uiplanning__block');\r\n\r\n\tthis.ux_interactions();\r\n\r\n\t// --- if a configuration is set ==> display it\r\n\tif (this._options.planning !== null) {\r\n\t\tthis.model_restore();\r\n\t\tif (this._options.stateDefault !== null) {\r\n\t\t\tthis.model_setState(this._options.stateDefault);\r\n\t\t}\r\n\t}\r\n\r\n\t// if a default state is set ==> fill all block with it\r\n\telse if (this._options.stateDefault !== null) {\r\n\t\tthis.model_setState(this._options.stateDefault);\r\n\t\tthis.dom_setBlocksState(this._allBlocks, this._state);\r\n\t}\r\n\r\n\tthis._rangesRenderLock = false;\r\n\tthis.dom_renderRanges();\r\n};\r\n\r\nUIPlanning.prototype.ux_interactions = function () {\r\n\tthis._containerEl\r\n\r\n\t// --- complete day\r\n\t\t.on('click', '.uiplanning__day', this._callbacks.ux_rowState)\r\n\t\t.on('mouseenter', '.uiplanning__day', this._callbacks.ux_rowHover)\r\n\t\t.on('mouseleave', '.uiplanning__day', this._callbacks.ux_releaseHover)\r\n\r\n\t\t// ---\tcomplete hour\r\n\t\t.on('click', '.uiplanning__hour', this._callbacks.ux_columnState)\r\n\t\t.on('mouseenter', '.uiplanning__hour', this._callbacks.ux_columnHover)\r\n\t\t.on('mouseleave', '.uiplanning__hour', this._callbacks.ux_releaseHover)\r\n\r\n\t\t// ---\thour part\r\n\t\t.on('click', '.uiplanning__hour-part', this._callbacks.ux_columnState)\r\n\t\t.on('mouseenter', '.uiplanning__hour-part', this._callbacks.ux_columnHover)\r\n\t\t.on('mouseleave', '.uiplanning__hour-part', this._callbacks.ux_releaseHover)\r\n\r\n\t\t// --- element\r\n\t\t.on('mousedown', '.uiplanning__block', this._callbacks.ux_blockStateMouseState)\r\n\t;\r\n\r\n\tthis._controlsEl\r\n\t\t.on('click', '.planning-state-selector', this._callbacks.model_setState)\r\n\t;\r\n};\r\nUIPlanning.prototype.ux_displayError = function (message) {\r\n\tthis._feedbackEl.html(message);\r\n};\r\n\r\nUIPlanning.prototype.ux_blockStateMouseState = function (e) {\r\n\tif (!this._state) {\r\n\t\tthis.ux_displayError('no-state-selected');\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (e.button && e.button === 2) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (e.type === 'mousedown') {\r\n\t\tthis._containerEl.on('mouseenter', '.uiplanning__block', this._callbacks.ux_blockState);\r\n\t\t$(document).on('mouseup dragend', this._callbacks.ux_blockStateMouseState);\r\n\t\tif ($(e.target).is('.uiplanning__block')) {\r\n\t\t\tthis.ux_blockState(e);\r\n\t\t}\r\n\t}\r\n\telse if (e.type === 'mouseup') {\r\n\t\tthis._containerEl.off('mouseenter', '.uiplanning__block', this._callbacks.ux_blockState);\r\n\t\t$(document).off('mouseup dragend', this._callbacks.ux_blockStateMouseState);\r\n\t}\r\n};\r\nUIPlanning.prototype.ux_blockState = function (e) {\r\n\tif (!this._state) {\r\n\t\tthis.ux_displayError('no-state-selected');\r\n\t\treturn;\r\n\t}\r\n\r\n\tthis.dom_setBlocksState($(e.target), this._state);\r\n};\r\n\r\nUIPlanning.prototype.ux_releaseHover = function () {\r\n\tthis._allBlocks.removeClass('uiplanning--target-hover');\r\n};\r\n\r\nUIPlanning.prototype.ux_rowSelect = function (e) {\r\n\treturn $(e.target).closest('.uiplanning-row').find('.uiplanning__block');\r\n};\r\nUIPlanning.prototype.ux_rowHover = function (e) {\r\n\tthis.ux_releaseHover();\r\n\tthis.ux_rowSelect(e).addClass('uiplanning--target-hover');\r\n};\r\nUIPlanning.prototype.ux_rowState = function (e) {\r\n\tif (!this._state) {\r\n\t\tthis.ux_displayError('no-state-selected');\r\n\t\treturn;\r\n\t}\r\n\tthis.dom_setBlocksState(this.ux_rowSelect(e), this._state);\r\n};\r\n\r\nUIPlanning.prototype.ux_columnSelect = function (e) {\r\n\tvar el = $(e.target), index, selectors;\r\n\r\n\t// ---\tcomplete hour\r\n\tif (el.is('.uiplanning__hour')) {\r\n\t\tindex = el.closest('.uiplanning-row').find('.uiplanning__hour').index(el);\r\n\t\tselectors = [];\r\n\t\tfor (var i = index * this._options.hourParts, iLen = i + this._options.hourParts; i < iLen; ++i) {\r\n\t\t\tselectors.push('.uiplanning__block:eq(' + i + ')');\r\n\t\t}\r\n\t\treturn $('.uiplanning-row__day').find(selectors.join(', '));\r\n\t}\r\n\t// ---\thour parts\r\n\telse if (el.is('.uiplanning__hour-part')) {\r\n\t\tindex = el.closest('.uiplanning-row').find('.uiplanning__hour-part').index(el);\r\n\t\treturn $('.uiplanning-row__day').find('.uiplanning__block:eq(' + index + ')');\r\n\r\n\t}\r\n};\r\nUIPlanning.prototype.ux_columnHover = function (e) {\r\n\tthis.ux_releaseHover();\r\n\tthis.ux_columnSelect(e).addClass('uiplanning--target-hover');\r\n};\r\nUIPlanning.prototype.ux_columnState = function (e) {\r\n\tif (!this._state) {\r\n\t\tthis.ux_displayError('no-state-selected');\r\n\t\treturn;\r\n\t}\r\n\tthis.dom_setBlocksState(this.ux_columnSelect(e), this._state);\r\n};\r\n\r\nUIPlanning.prototype.dom_setBlocksState = function (blocks, state) {\r\n\tif (!blocks || blocks.length === 0) {\r\n\t\tconsole.log('no-target');\r\n\t\treturn;\r\n\t}\r\n\r\n\tblocks.attr('data-state', state ? state.uid : null);\r\n\r\n\t// render is lock --> skip render\r\n\tif (!this._rangesRenderLock) {\r\n\t\tthis.dom_renderRanges();\r\n\t}\r\n};\r\nUIPlanning.prototype.dom_renderRanges = function () {\r\n\tvar self = this,\r\n\t\tstr,\r\n\t\tranges, iRange, iRangeLen, range;\r\n\r\n\t// --- clear former state\r\n\tthis._containerEl.find('.uiplanning__range').remove();\r\n\r\n\tranges = this.model_retrieveRanges().ranges;\r\n\tfor (iRange = 0, iRangeLen = ranges.length; iRange < iRangeLen; ++iRange) {\r\n\t\trange = ranges[iRange];\r\n\r\n\t\t// --- create tooltip instance\r\n\t\tstr = '';\r\n\t\tstr += '<div class=\"uiplanning__range\">';\r\n\t\tstr += '<div class=\"uiplanning__range-area\"></div>';\r\n\t\tstr += '<div class=\"uiplanning__range-tooltip\">' + range.start + ' - ' + range.end + '</div>';\r\n\t\tstr += '</div>';\r\n\t\trange.tipEl = $(str);\r\n\r\n\t\trange.tipEl\r\n\t\t\t.css({\r\n\t\t\t\twidth: range.endBlock.offset().left - range.startBlock.offset().left + range.startBlock.width()\r\n\t\t\t})\r\n\t\t\t.appendTo(range.startBlock)\r\n\t\t\t.find('.uiplanning__range-area')\r\n\t\t\t\t.css({\r\n\t\t\t\t\t'background-color': range.state.color,\r\n\t\t\t\t});\r\n\r\n\t\t(function(range){\r\n\t\t\tfor(var a = range.startIndex; a <= range.endIndex; a++){\r\n\t\t\t\tself._cells[range.day][a]\r\n\t\t\t\t\t.on('mouseover', function(){\r\n\t\t\t\t\t\trange.tipEl.addClass('show-tooltip');\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.on('mouseout', function(){\r\n\t\t\t\t\t\trange.tipEl.removeClass('show-tooltip');\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t}(range));\r\n\t}\r\n};\r\nUIPlanning.prototype.dom_build = function () {\r\n\tvar str,\r\n\t\tself = this,\r\n\t\ti, iLen,\r\n\t\tiDay,\r\n\t\tclasses,\r\n\t\tdayCells,\r\n\t\tiHour, iHourMod, iHourLen;\r\n\r\n\r\n\t// ##################### BUILD STATES SELECTORS\r\n\r\n\tstr = '';\r\n\tfor (i = 0, iLen = this._options.states.length; i < iLen; ++i) {\r\n\t\tstr += '<div class=\"planning-state-selector\" data-state=\"' + this._options.states[i].uid + '\">'\r\n\t\t\t+ '<span class=\"bullet\" style=\"background-color: ' + this._options.states[i].color + ';\"></span>'\r\n\t\t\t+ this._options.states[i].label\r\n\t\t\t+ '</div>';\r\n\t}\r\n\tthis._controlsEl.find('.controls-selectors').append(str);\r\n\r\n\r\n\t// ##################### BUILD GRID\r\n\r\n\tstr = '';\r\n\tiHourLen = 24 * this._options.hourParts;\r\n\r\n\t// ---\thours display\r\n\r\n\tstr += '<div class=\"uiplanning-row uiplanning-row__hours\">';\r\n\tstr += '<div></div>';\r\n\tfor (iHour = 0; iHour < iHourLen; iHour++) {\r\n\t\tiHourMod = iHour % this._options.hourParts;\r\n\t\tif (iHourMod === 0) {\r\n\t\t\tstr += '<div class=\"uiplanning__hour';\r\n\t\t\tif(iHour > 0 && (iHour / this._options.hourParts) % 6 == 0){\r\n\t\t\t\tstr += ' uiplanning--hour-start-xl';\r\n\t\t\t}\r\n\t\t\tstr += '\">' + Math.ceil(iHour / this._options.hourParts) + 'h';\r\n\t\t}\r\n\t\telse if (iHourMod === (this._options.hourParts - 1))\r\n\t\t\tstr += '</div>';\r\n\t}\r\n\tstr += '</div>';\r\n\r\n\r\n\tstr += '<div class=\"uiplanning-row uiplanning-row__hour-parts\">';\r\n\tstr += '<div></div>';\r\n\tfor (iHour = 0; iHour < iHourLen; iHour++) {\r\n\t\tstr += '<div class=\"uiplanning__hour-part';\r\n\t\tif(iHour > 0 && (iHour / this._options.hourParts) % 6 == 0){\r\n\t\t\tstr += ' uiplanning--hour-start-xl';\r\n\t\t}\r\n\t\tstr += '\"></div>';\r\n\t}\r\n\tstr += '</div>';\r\n\r\n\r\n\t// ---\tdays display\r\n\tfor (iDay = 0; iDay < 7; iDay++) {\r\n\t\tstr += '<div class=\"uiplanning-row uiplanning-row__day\">';\r\n\t\tstr += '<div class=\"uiplanning__day\">' + this._options.dayNames[iDay] + '</div>';\r\n\t\tfor (iHour = 0; iHour < iHourLen; iHour++) {\r\n\t\t\tclasses = 'uiplanning__block';\r\n\t\t\tif (iHour % this._options.hourParts === 0) {\r\n\t\t\t\tclasses += (iHour > 0 && ((iHour / this._options.hourParts) % 6 == 0)) ? ' uiplanning--hour-start-xl' : ' uiplanning--hour-start';\r\n\t\t\t}\r\n\t\t\tstr += '<div class=\"' + classes + '\"></div>';\r\n\t\t}\r\n\t\tstr += '</div>';\r\n\t}\r\n\r\n\tthis._containerEl.append($(str));\r\n\r\n\r\n\t// --- store all cells\r\n\r\n\tthis._cells = [];\r\n\tthis._containerEl.find('.uiplanning-row__day').each(function (rowIndex, rowEl) {\r\n\t\trowEl = $(rowEl);\r\n\t\tdayCells = [];\r\n\t\trowEl.find('.uiplanning__block').each(function (blockIndex, blockEl) {\r\n\t\t\tdayCells.push($(blockEl));\r\n\t\t});\r\n\t\tself._cells.push(dayCells);\r\n\t});\r\n};\r\n\r\nUIPlanning.prototype.model_retrieveState = function (input) {\r\n\t// retrieve state from event\r\n\tif (typeof input === 'object' && input.hasOwnProperty('target')) {\r\n\t\tinput = $(input.target).attr('data-state');\r\n\t}\r\n\r\n\t// prevent illegal calls\r\n\tif (input === null || typeof input !== 'string') {\r\n\t\tconsole.log('[UIPlanning.model_setState] Unable to retrieve state from passed-in parameter: ', input);\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfor (var i = 0, iLen = this._options.states.length; i < iLen; ++i) {\r\n\t\tif (this._options.states[i].uid === input) {\r\n\t\t\treturn this._options.states[i];\r\n\t\t}\r\n\t}\r\n\r\n\tconsole.log('[UIPlanning.model_setState] Unable to retrieve state from UID: ', input);\r\n\treturn false;\r\n};\r\nUIPlanning.prototype.model_setState = function (state) {\r\n\tstate = this.model_retrieveState(state);\r\n\tif (state === false) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tthis._state = state;\r\n\tthis._controlsEl.find('.planning-state-selector')\r\n\t\t.removeClass('active')\r\n\t\t.filter('[data-state=\"' + this._state.uid + '\"]').addClass('active');\r\n\tthis._domEl.trigger('stateSelected', {\r\n\t\tstate: this._state\r\n\t});\r\n};\r\nUIPlanning.prototype.model_restore = function () {\r\n\tvar\r\n\t\tp = this._options.planning,\r\n\t\tiDay, rowDay,\r\n\t\tiRange, iRangeLen, range, state,\r\n\t\tiCell, iCellLen;\r\n\r\n\tif (this._options.stateDefault !== null) {\r\n\t\tthis.dom_setBlocksState(this._allBlocks, this.model_retrieveState(this._options.stateDefault));\r\n\t}\r\n\r\n\t// --- day loop\r\n\tfor (iDay = 0; iDay < 7; ++iDay) {\r\n\t\trowDay = this._containerEl.find('.uiplanning-row__day:eq(' + iDay + ')');\r\n\r\n\t\t// --- range loop\r\n\t\tfor (iRange = 0, iRangeLen = p[iDay].length; iRange < iRangeLen; ++iRange) {\r\n\t\t\trange = p[iDay][iRange];\r\n\t\t\tstate = this.model_retrieveState(range.s);\r\n\r\n\t\t\t// --- cell loop\r\n\t\t\tfor (iCell = this._convertHourToIndex(range.start), iCellLen = this._convertHourToIndex(range.end); iCell < iCellLen; ++iCell) {\r\n\t\t\t\tthis.dom_setBlocksState(rowDay.find('.uiplanning__block:eq(' + iCell + ')'), state);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tconsole.log('[UIPlanning.model_restore] import completed');\r\n};\r\nUIPlanning.prototype.model_export = function () {\r\n\tvar settings = this.model_retrieveRanges();\r\n\tconsole.log('model_export', JSON.stringify(settings.week));\r\n\treturn settings.week;\r\n};\r\nUIPlanning.prototype.model_retrieveRanges = function () {\r\n\tvar\r\n\t\tiRow, iRowLen, row,\r\n\t\tiRange, iRangeLen,\r\n\t\tiBlock, iBlockLen, block,\r\n\t\tout = {\r\n\t\t\tranges: [],\r\n\t\t\tweek: []\r\n\t\t},\r\n\t\trowRanges, outRange;\r\n\r\n\t// console.time('model_retrieveRanges');\r\n\tfor (iRow = 0, iRowLen = this._cells.length; iRow < iRowLen; ++iRow) {\r\n\t\trow = this._cells[iRow];\r\n\t\trowRanges = [];\r\n\t\tfor (iBlock = 0, iBlockLen = row.length; iBlock < iBlockLen; ++iBlock) {\r\n\t\t\tblock = row[iBlock];\r\n\r\n\t\t\tif (!outRange) {\r\n\t\t\t\toutRange = {\r\n\t\t\t\t\ts: block.attr('data-state'),\r\n\t\t\t\t\tstate: this.model_retrieveState(block.attr('data-state')),\r\n\t\t\t\t\tday: iRow,\r\n\t\t\t\t\tstart: this._convertIndexToHour(iBlock, false),\r\n\t\t\t\t\tstartIndex: iBlock,\r\n\t\t\t\t\tstartBlock: row[iBlock]\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\telse if (block.attr('data-state') !== outRange.s) {\r\n\r\n\t\t\t\tif (outRange.s !== '') {\r\n\t\t\t\t\toutRange.end = this._convertIndexToHour(iBlock, true);\r\n\t\t\t\t\toutRange.endIndex = iBlock - 1;\r\n\t\t\t\t\toutRange.endBlock = row[iBlock - 1];\r\n\t\t\t\t\trowRanges.push(outRange);\r\n\t\t\t\t}\r\n\r\n\t\t\t\toutRange = {\r\n\t\t\t\t\ts: block.attr('data-state'),\r\n\t\t\t\t\tstate: this.model_retrieveState(block.attr('data-state')),\r\n\t\t\t\t\tday: iRow,\r\n\t\t\t\t\tstart: this._convertIndexToHour(iBlock, false),\r\n\t\t\t\t\tstartIndex: iBlock,\r\n\t\t\t\t\tstartBlock: row[iBlock]\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// if a range is opened --> close and store data\r\n\t\tif (outRange && outRange.s != '') {\r\n\t\t\toutRange.end = this._convertIndexToHour(iBlock, true);\r\n\t\t\toutRange.endIndex = iBlockLen - 1;\r\n\t\t\toutRange.endBlock = row[iBlockLen - 1];\r\n\t\t\trowRanges.push(outRange);\r\n\t\t}\r\n\t\toutRange = null;\r\n\r\n\t\t// copy row ranges\r\n\t\tout.week[iRow] = [];\r\n\t\tfor (iRange = 0, iRangeLen = rowRanges.length; iRange < iRangeLen; ++iRange) {\r\n\t\t\tout.ranges.push(rowRanges[iRange]);\r\n\t\t\tout.week[iRow].push({\r\n\t\t\t\ts: rowRanges[iRange].s,\r\n\t\t\t\tstart: rowRanges[iRange].start,\r\n\t\t\t\tend: rowRanges[iRange].end\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t// console.timeEnd('model_retrieveRanges');\r\n\treturn out;\r\n};\r\n\r\n\r\nUIPlanning.prototype._convertHourToIndex = function (s) {\r\n\tvar tokens = s.split(':'),\r\n\t\th = parseInt(tokens[0]),\r\n\t\tm = parseInt(tokens[1]);\r\n\tif (m % (60 / this._options.hourParts) !== 0)\r\n\t\tm += 1;\r\n\treturn (h * this._options.hourParts) + (m / (60 / this._options.hourParts));\r\n};\r\nUIPlanning.prototype._convertIndexToHour = function (i, offset) {\r\n\tvar h, m, s;\r\n\th = Math.floor(i / this._options.hourParts);\r\n\tm = 60 / this._options.hourParts * (i % this._options.hourParts);\r\n\tif (offset === true) {\r\n\t\tm = (m - 1 + 60) % 60;\r\n\t\tif (m === 59)\r\n\t\t\th -= 1;\r\n\t}\r\n\th = (h + 24) % 24;\r\n\r\n\th = h.toString();\r\n\tm = m.toString();\r\n\r\n\ts = '';\r\n\ts += (h.length < 2) ? '0' + h : h;\r\n\ts += ':';\r\n\ts += (m.length < 2) ? '0' + m : m;\r\n\treturn s;\r\n};\r\n"]}