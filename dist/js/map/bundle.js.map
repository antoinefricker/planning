{"version":3,"sources":["bundle.js"],"names":["GVPlanning","selector","options","this","_o","Object","assign","feedbackCallback","hourFrom","hourTo","hourParts","days","states","stateDefault","stateSelectedDefault","model_getState","_cbs","model_setState","bind","ux_unsetHover","ux_colStateWatch","ux_colState","ux_colHover","ux_rowState","ux_rowHover","ux_blockState","ux_blockStateWatch","dom_renderRanges","_state","_rangesRenderLock","_dragStatus","_planning","ranges","week","_domEl","$","addClass","_containerEl","find","_controlsEl","dom_build","on","e","preventDefault","window","planning","model_restore","p","prototype","ux_error","message","type","level","console","log","button","document","state","off","block","blockState","row","xBlock","yBlock","selBlocks","min","max","target","parent","index","parseInt","attr","y","x","uid","_cellsByDay","slice","dom_setBlocksState","_cellsAll","removeClass","ux_rowSelect","closest","ux_colSelect","selectors","el","hasClass","i","iLen","push","join","classList","blocks","length","str","iRange","iRangeLen","range","self","remove","model_retrieveRanges","day","startBlock","start","end","tipEl","css","width","endBlock","offset","left","appendTo","background-color","color","a","startIndex","endIndex","_cellsGridArr","iDay","iDayLen","classes","dayCells","iHour","iHourMod","iHourLen","label","append","Math","ceil","each","rowIndex","rowEl","blockIndex","blockEl","input","hasOwnProperty","warn","filter","trigger","rowDay","iCell","iCellLen","s","_convertHourToIndex","model_export","settings","JSON","stringify","stateUID","iBlock","iBlockLen","rowRanges","outRange","splice","_convertIndexToHour","tokens","split","h","m","floor","toString"],"mappings":"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","file":"../bundle.js","sourcesContent":["var GVPlanning = function (selector, options) {\r\n\r\n\t// ##########################################\r\n\r\n\t// --- options\r\n\r\n\tthis._o = Object.assign({\r\n\t\tfeedbackCallback: null,\r\n\t\thourFrom: 0,\r\n\t\thourTo: 24,\r\n\t\thourParts: 4,\r\n\t\tdays: [],\r\n\t\tstates: [],\r\n\t\tstateDefault: null,\r\n\t\tstateSelectedDefault: null,\r\n\t}, options);\r\n\r\n\tif(this._o.stateDefault == null)\r\n\t\tthis._o.stateDefault = this._o.states[0];\r\n\telse if(typeof this._o.stateDefault == 'string')\r\n\t\tthis._o.stateDefault = this.model_getState(this._o.stateDefault);\r\n\r\n\r\n\t// --- variables initialization\r\n\r\n\tthis._cbs = {\r\n\t\tmodel_setState: this.model_setState.bind(this),\r\n\t\tux_unsetHover: this.ux_unsetHover.bind(this),\r\n\t\tux_colStateWatch: this.ux_colStateWatch.bind(this),\r\n\t\tux_colState: this.ux_colState.bind(this),\r\n\t\tux_colHover: this.ux_colHover.bind(this),\r\n\t\tux_rowState: this.ux_rowState.bind(this),\r\n\t\tux_rowHover: this.ux_rowHover.bind(this),\r\n\t\tux_blockState: this.ux_blockState.bind(this),\r\n\t\tux_blockStateWatch: this.ux_blockStateWatch.bind(this),\r\n\t\tdom_renderRanges: this.dom_renderRanges.bind(this),\r\n\t};\r\n\r\n\tthis._state = null;\r\n\r\n\t// allow developper to lock rendering during extensive update processes\r\n\tthis._rangesRenderLock = false;\r\n\t// while dragging to \"paint\" in block-type cells, store the position of the drag start position\r\n\tthis._dragStatus = null;\r\n\t// store all ranges settings\r\n\tthis._planning = {\r\n\t\tranges: [],\r\n\t\tweek: [],\r\n\t};\r\n\t\r\n\t// ########################################## INIT INSTANCE\r\n\r\n\tthis._domEl = $(selector).addClass('gvp');\r\n\tthis._containerEl = this._domEl.find('.gvp-container');\r\n\tthis._controlsEl = this._domEl.find('.gvp-controls');\r\n\r\n\tthis.dom_build();\r\n\r\n\tthis._containerEl\r\n\t\t// --- complete day\r\n\t\t.on('click', '.gvp__day', this._cbs.ux_rowState)\r\n\t\t.on('mouseover', '.gvp__day', this._cbs.ux_rowHover)\r\n\t\t.on('mouseleave', '.gvp__day', this._cbs.ux_unsetHover)\r\n\t\t// ---\tcomplete hour\r\n\t\t.on('mousedown', '.gvp__hour', this._cbs.ux_colStateWatch)\r\n\t\t.on('mouseover', '.gvp__hour', this._cbs.ux_colHover)\r\n\t\t.on('mouseleave', '.gvp__hour', this._cbs.ux_unsetHover)\r\n\t\t// ---\thour part\r\n\t\t.on('mousedown', '.gvp__hour-part', this._cbs.ux_colStateWatch)\r\n\t\t.on('mouseover', '.gvp__hour-part', this._cbs.ux_colHover)\r\n\t\t.on('mouseleave', '.gvp__hour-part', this._cbs.ux_unsetHover)\r\n\t\t// --- element\r\n\t\t.on('mousedown', '.gvp__block', this._cbs.ux_blockStateWatch)\r\n\t;\r\n\r\n\tthis._domEl.on('dragstart', function(e){\r\n\t\te.preventDefault();\r\n\t\treturn false;\r\n\t});\r\n\tthis._controlsEl\r\n\t\t.on('click', '.gvp-state-selector', this._cbs.model_setState)\r\n\t;\r\n\r\n\t$(window).on('resize', this._cbs.dom_renderRanges)\r\n\r\n\r\n\t// --- if a configuration is set ==> display it\r\n\tif (this._o.planning){\r\n\t\tthis.model_restore();\r\n\t}\r\n\tif (this._o.stateSelectedDefault){\r\n\t\tthis.model_setState(this._o.stateSelectedDefault);\r\n\t}\r\n};\r\nvar p = GVPlanning.prototype;\r\n\r\np.ux_error = function (message, type) {\r\n\tif(this._o.feedbackCallback){\r\n\t\tthis._o.feedbackCallback(message, level);\r\n\t}\r\n\tconsole.log('[' + level + ']', message);\r\n};\r\np.ux_blockStateWatch = function (e) {\r\n\tif (!this._state) {\r\n\t\tthis.ux_error('no-state-selected', 'info');\r\n\t\treturn;\r\n\t}\r\n\tif (e.button && e.button === 2) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (e.type === 'mousedown') {\r\n\t\tthis._containerEl\r\n\t\t\t.on('mouseover', '.gvp__block', this._cbs.ux_blockState);\r\n\t\t$(document)\r\n\t\t\t.on('mouseup', this._cbs.ux_blockStateWatch);\r\n\t\t$(window)\r\n\t\t\t.on('mouseup', this._cbs.ux_blockStateWatch);\r\n\r\n\t\tthis.ux_blockState(e);\r\n\t}\r\n\telse{\r\n\t\t// ckec for state restoration\r\n\t\tif(this._dragStatus.state)\r\n\t\t\tthis.model_setState(this._dragStatus.state);\r\n\t\t// release drag lock\r\n\t\tthis._dragStatus = null;\r\n\r\n\t\tthis._containerEl\r\n\t\t\t.off('mouseover', '.gvp__block', this._cbs.ux_blockState);\r\n\t\t$(document)\r\n\t\t\t.off('mouseup', this._cbs.ux_blockStateWatch);\r\n\t\t$(window)\r\n\t\t\t.off('mouseup', this._cbs.ux_blockStateWatch);\r\n\t}\r\n};\r\np.ux_blockState = function (e) {\r\n\tvar block, blockState, row, xBlock, yBlock, selBlocks, min, max;\r\n\r\n\tif (!this._state) {\r\n\t\tthis.ux_error('no-state-selected', 'info');\r\n\t\treturn;\r\n\t}\r\n\r\n\tblock = $(e.target);\r\n\trow = block.parent('.gvp-row__day');\r\n\txBlock = row.find('.gvp__block').index(block);\r\n\tyBlock = parseInt(row.attr('data-day-index'));\r\n\r\n\tif(!this._dragStatus){\r\n\t\tthis._dragStatus = {\r\n\t\t\tx: xBlock,\r\n\t\t\ty: yBlock,\r\n\t\t};\r\n\t\tblockState = block.attr('data-state');\r\n\t\tif(blockState === this._state.uid){\r\n\t\t\tthis.model_setState(this._o.stateDefault.uid);\r\n\t\t\tthis._dragStatus.state = blockState;\r\n\t\t}\r\n\t}\r\n\telse if(yBlock != this._dragStatus.y){\r\n\t\treturn;\r\n\t}\r\n\r\n\tif(xBlock > this._dragStatus.x){\r\n\t\tmin = this._dragStatus.x;\r\n\t\tmax = xBlock;\r\n\t}\r\n\telse{\r\n\t\tmin = xBlock;\r\n\t\tmax = this._dragStatus.x;\r\n\t}\r\n\tselBlocks = this._cellsByDay[yBlock].slice(min, max + 1);\r\n\tthis.dom_setBlocksState(selBlocks, this._state);\r\n};\r\np.ux_unsetHover = function () {\r\n\tthis._cellsAll.removeClass('gvp--target-hover');\r\n};\r\np.ux_rowSelect = function (e) {\r\n\treturn $(e.target).closest('.gvp-row').find('.gvp__block');\r\n};\r\np.ux_rowHover = function (e) {\r\n\tthis.ux_unsetHover();\r\n\tthis.ux_rowSelect(e).addClass('gvp--target-hover');\r\n};\r\np.ux_rowState = function (e) {\r\n\tif (!this._state) {\r\n\t\tthis.ux_error('no-state-selected', 'info');\r\n\t\treturn;\r\n\t}\r\n\tthis.dom_setBlocksState(this.ux_rowSelect(e), this._state);\r\n};\r\n\r\np.ux_colStateWatch = function (e) {\r\n\tvar el = $(e.target),\r\n\t\tindex,\r\n\t\tselectors;\r\n\r\n\tif (e.type === 'mousedown') {\r\n\t\tthis._containerEl\r\n\t\t\t.on('mouseover', '.gvp__hour', this._cbs.ux_colState)\r\n\t\t\t.on('mouseover', '.gvp__hour-part', this._cbs.ux_colState)\r\n\t\t;\r\n\t\t$(document)\r\n\t\t\t.on('mouseup', this._cbs.ux_colStateWatch);\r\n\t\t$(window)\r\n\t\t\t.on('mouseup', this._cbs.ux_colStateWatch);\r\n\t\tthis.ux_colState(e);\r\n\t}\r\n\telse{\r\n\t\tthis._containerEl\r\n\t\t\t.off('mouseover', '.gvp__hour', this._cbs.ux_colState)\r\n\t\t\t.off('mouseover', '.gvp__hour-part', this._cbs.ux_colState)\r\n\t\t;\r\n\t\t$(document)\r\n\t\t\t.off('mouseup', this._cbs.ux_colStateWatch);\r\n\t\t$(window)\r\n\t\t\t.off('mouseup', this._cbs.ux_colStateWatch);\r\n\t}\r\n}\r\np.ux_colSelect = function (e) {\r\n\tvar el = $(e.target), index, selectors;\r\n\r\n\t// ---\tcomplete hour\r\n\tif (el.hasClass('gvp__hour')) {\r\n\t\tindex = el.closest('.gvp-row').find('.gvp__hour').index(el);\r\n\t\tselectors = [];\r\n\t\tfor (var i = index * this._o.hourParts, iLen = i + this._o.hourParts; i < iLen; ++i) {\r\n\t\t\tselectors.push('.gvp__block:eq(' + i + ')');\r\n\t\t}\r\n\t\treturn $('.gvp-row__day').find(selectors.join(', '));\r\n\t}\r\n\t// ---\thour parts\r\n\telse if (el.hasClass('gvp__hour-part')) {\r\n\t\tindex = el.closest('.gvp-row').find('.gvp__hour-part').index(el);\r\n\t\treturn $('.gvp-row__day').find('.gvp__block:eq(' + index + ')');\r\n\t}\r\n\telse{\r\n\t\tconsole.log(el[0].classList, el);\r\n\t}\r\n\treturn $('#void');\r\n};\r\np.ux_colHover = function (e) {\r\n\tthis.ux_unsetHover();\r\n\tthis.ux_colSelect(e).addClass('gvp--target-hover');\r\n};\r\np.ux_colState = function (e) {\r\n\tif (!this._state) {\r\n\t\tthis.ux_error('no-state-selected', 'info');\r\n\t\treturn;\r\n\t}\r\n\tthis.dom_setBlocksState(this.ux_colSelect(e), this._state);\r\n};\r\n\r\np.dom_setBlocksState = function (blocks, state) {\r\n\tif (!blocks || blocks.length === 0) {\r\n\t\tconsole.log('[dom_setBlocksState] no target');\r\n\t\treturn;\r\n\t}\r\n\r\n\tblocks.attr('data-state', state ? state.uid : null);\r\n\r\n\t// render is lock --> skip render\r\n\tif (!this._rangesRenderLock) {\r\n\t\tthis.dom_renderRanges();\r\n\t}\r\n};\r\np.dom_renderRanges = function () {\r\n\tvar self = this,\r\n\t\tstr,\r\n\t\tranges, iRange, iRangeLen, range;\r\n\r\n\t// console.time('dom_renderRanges');\r\n\r\n\t// no drag process running, remove former ranges elements\r\n\tif(this._dragStatus){\r\n\t\tthis._containerEl\r\n\t\t\t.find('.gvp-row__day[data-day-index=\"' + this._dragStatus.y + '\"]')\r\n\t\t\t.find('.gvp__range')\r\n\t\t\t.remove();\r\n\t}\r\n\telse{\r\n\t\tthis._containerEl\r\n\t\t\t.find('.gvp__range')\r\n\t\t\t.remove();\r\n\t}\r\n\r\n\tranges = this.model_retrieveRanges().ranges;\r\n\tfor (iRange = 0, iRangeLen = ranges.length; iRange < iRangeLen; ++iRange) {\r\n\t\trange = ranges[iRange];\r\n\r\n\t\tif(this._dragStatus){\r\n\t\t\tif(range.day !== this._dragStatus.y)\r\n\t\t\t\tcontinue;\r\n\t\t\trange.startBlock.find('.gvp__range').remove();\r\n\t\t}\r\n\r\n\t\t// --- create tooltip instance\r\n\t\tstr = '<div class=\"gvp__range\">';\r\n\t\tstr += '<div class=\"gvp__range-area\"></div>';\r\n\t\tstr += '<div class=\"gvp__range-tooltip\">' + range.start + ' - ' + range.end + '</div>';\r\n\t\tstr += '</div>';\r\n\t\trange.tipEl = $(str);\r\n\r\n\t\trange.tipEl\r\n\t\t\t.css({\r\n\t\t\t\twidth: range.endBlock.offset().left - range.startBlock.offset().left + range.startBlock.width()\r\n\t\t\t})\r\n\t\t\t.appendTo(range.startBlock)\r\n\t\t\t.find('.gvp__range-area')\r\n\t\t\t\t.css({\r\n\t\t\t\t\t'background-color': range.state.color,\r\n\t\t\t\t});\r\n\r\n\t\t(function(range){\r\n\t\t\tfor(var a = range.startIndex; a <= range.endIndex; a++){\r\n\t\t\t\tself._cellsGridArr[range.day][a]\r\n\t\t\t\t\t.on('mouseover', function(){\r\n\t\t\t\t\t\trange.tipEl.addClass('show-tooltip');\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.on('mouseout', function(){\r\n\t\t\t\t\t\trange.tipEl.removeClass('show-tooltip');\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t}(range));\r\n\t}\r\n\r\n\t// console.timeEnd('dom_renderRanges');\r\n};\r\np.dom_build = function () {\r\n\tvar str,\r\n\t\tself = this,\r\n\t\ti, iLen,\r\n\t\tiDay, iDayLen,\r\n\t\tclasses,\r\n\t\tdayCells,\r\n\t\tiHour, iHourMod, iHourLen;\r\n\r\n\r\n\t// ##################### BUILD STATES SELECTORS\r\n\r\n\tstr = '';\r\n\tfor (i = 0, iLen = this._o.states.length; i < iLen; ++i) {\r\n\t\tstr += '<div class=\"gvp-state-selector\" data-state=\"' + this._o.states[i].uid + '\">'\r\n\t\t\t+ '<span class=\"bullet\" style=\"background-color: ' + this._o.states[i].color + ';\"></span>'\r\n\t\t\t+ this._o.states[i].label\r\n\t\t\t+ '</div>';\r\n\t}\r\n\tthis._controlsEl.find('.controls-selectors').append(str);\r\n\r\n\r\n\t// ##################### BUILD GRID\r\n\r\n\tstr = '';\r\n\tiHourLen = 24 * this._o.hourParts;\r\n\r\n\t// ---\thours display\r\n\r\n\tstr += '<div class=\"gvp-row gvp-row__hours\">';\r\n\tstr += '<div></div>';\r\n\tfor (iHour = 0; iHour < iHourLen; iHour++) {\r\n\t\tiHourMod = iHour % this._o.hourParts;\r\n\t\tif (iHourMod === 0) {\r\n\t\t\tstr += '<div class=\"gvp__hour gvp--hour-start';\r\n\t\t\tif(iHour > 0 && (iHour / this._o.hourParts) % 6 == 0){\r\n\t\t\t\tstr += '-xl';\r\n\t\t\t}\r\n\t\t\tstr += '\"><span>' + Math.ceil(iHour / this._o.hourParts) + 'h' + '</span>';\r\n\t\t}\r\n\t\telse if (iHourMod === (this._o.hourParts - 1))\r\n\t\t\tstr += '</div>';\r\n\t}\r\n\tstr += '</div>';\r\n\r\n\r\n\tstr += '<div class=\"gvp-row gvp-row__hour-parts\">';\r\n\tstr += '<div></div>';\r\n\tfor (iHour = 0; iHour < iHourLen; iHour++) {\r\n\t\tstr += '<div class=\"gvp__hour-part';\r\n\t\tif(iHour > 0 && (iHour / this._o.hourParts) % 6 == 0){\r\n\t\t\tstr += ' gvp--hour-start-xl';\r\n\t\t}\r\n\t\tstr += '\"></div>';\r\n\t}\r\n\tstr += '</div>';\r\n\r\n\r\n\t// ---\tdays display\r\n\tfor (iDay = 0, iDayLen = this._o.days.length; iDay < iDayLen; iDay++) {\r\n\t\tstr += '<div class=\"gvp-row gvp-row__day\" data-day-index=\"' + iDay + '\">';\r\n\t\tstr += '<div class=\"gvp__day\">' + this._o.days[iDay] + '</div>';\r\n\t\tfor (iHour = 0; iHour < iHourLen; iHour++) {\r\n\t\t\tclasses = 'gvp__block';\r\n\t\t\tif (iHour % this._o.hourParts === 0) {\r\n\t\t\t\tclasses += (iHour > 0 && ((iHour / this._o.hourParts) % 6 == 0)) ? ' gvp--hour-start-xl' : ' gvp--hour-start';\r\n\t\t\t}\r\n\t\t\tstr += '<div class=\"' + classes + '\"></div>';\r\n\t\t}\r\n\t\tstr += '</div>';\r\n\t}\r\n\r\n\tthis._containerEl.append($(str));\r\n\r\n\r\n\t// --- store all cells\r\n\r\n\tthis._cellsGridArr = [];\r\n\tthis._cellsByDay = [];\r\n\tthis._containerEl.find('.gvp-row__day').each(function (rowIndex, rowEl) {\r\n\t\trowEl = $(rowEl);\r\n\t\tdayCells = [];\r\n\t\trowEl.find('.gvp__block').each(function (blockIndex, blockEl) {\r\n\t\t\tdayCells.push($(blockEl));\r\n\t\t});\r\n\t\tself._cellsGridArr.push(dayCells);\r\n\t\tself._cellsByDay.push(rowEl.find('.gvp__block'));\r\n\t});\r\n\tself._cellsAll = this._containerEl.find('.gvp__block');\r\n};\r\n\r\np.model_getState = function (input) {\r\n\t// retrieve state from event\r\n\tif (typeof input === 'object' && input.hasOwnProperty('target')) {\r\n\t\tinput = $(input.target).attr('data-state');\r\n\t}\r\n\r\n\t// prevent illegal calls\r\n\tif (input === null || typeof input !== 'string') {\r\n\t\tconsole.warn('[GVPlanning.model_setState] Unable to retrieve state from passed-in parameter: ', input);\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfor (var i = 0, iLen = this._o.states.length; i < iLen; ++i) {\r\n\t\tif (this._o.states[i].uid === input) {\r\n\t\t\treturn this._o.states[i];\r\n\t\t}\r\n\t}\r\n\r\n\tconsole.log('[GVPlanning.model_setState] Unable to retrieve state from UID: ', input);\r\n\treturn false;\r\n};\r\np.model_setState = function (state) {\r\n\tstate = this.model_getState(state);\r\n\tif (state === false) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tthis._state = state;\r\n\tthis._controlsEl.find('.gvp-state-selector')\r\n\t\t.removeClass('active')\r\n\t\t.filter('[data-state=\"' + this._state.uid + '\"]').addClass('active');\r\n\tthis._domEl.trigger('stateSelected', {\r\n\t\tstate: this._state\r\n\t});\r\n};\r\np.model_restore = function () {\r\n\tvar\r\n\t\tp = this._o.planning,\r\n\t\tiDay, iDayLen, rowDay,\r\n\t\tiRange, iRangeLen, range, state,\r\n\t\tiCell, iCellLen;\r\n\r\n\tthis._rangesRenderLock = true;\r\n\r\n\t// --- day loop\r\n\tfor (iDay = 0, iDayLen = this._o.days.length; iDay < iDayLen; ++iDay) {\r\n\t\trowDay = this._containerEl.find('.gvp-row__day:eq(' + iDay + ')');\r\n\r\n\t\t// --- range loop\r\n\t\tfor (iRange = 0, iRangeLen = p[iDay].length; iRange < iRangeLen; ++iRange) {\r\n\t\t\trange = p[iDay][iRange];\r\n\t\t\tstate = this.model_getState(range.s);\r\n\r\n\t\t\t// --- cell loop\r\n\t\t\tfor (iCell = this._convertHourToIndex(range.start), iCellLen = this._convertHourToIndex(range.end); iCell < iCellLen; ++iCell) {\r\n\t\t\t\tthis.dom_setBlocksState(rowDay.find('.gvp__block:eq(' + iCell + ')'), state);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tthis._rangesRenderLock = false;\r\n\tthis.dom_renderRanges();\r\n\r\n\tconsole.log('[GVPlanning.model_restore] import completed');\r\n};\r\np.model_export = function () {\r\n\tvar settings = this.model_retrieveRanges();\r\n\tconsole.log('model_export', JSON.stringify(settings.week));\r\n\treturn settings.week;\r\n};\r\np.model_retrieveRanges = function () {\r\n\tvar\r\n\t\tstateUID,\r\n\t\tiDay, iDayLen, row,\r\n\t\tiRange, iRangeLen,\r\n\t\tiBlock, iBlockLen, block,\r\n\t\trowRanges, outRange;\r\n\r\n\t// console.time('model_retrieveRanges');\r\n\r\n\t// --- if a drag process is running remove all ranges belonging to the drag row\r\n\tif(this._dragStatus){\r\n\t\tfor(iRange = this._planning.ranges.length - 1; iRange >= 0; --iRange){\r\n\t\t\tif(this._planning.ranges[iRange].day === this._dragStatus.y){\r\n\t\t\t\tthis._planning.ranges.splice(iRange, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse{\r\n\t\tthis._planning.ranges = [];\r\n\t}\r\n\r\n\tfor (iDay = 0, iDayLen = this._o.days.length; iDay < iDayLen; ++iDay) {\r\n\r\n\t\t// --- if a drag process is running, check only the  drag row\r\n\t\tif(this._dragStatus && this._dragStatus.y !== iDay)\r\n\t\t\tcontinue;\r\n\r\n\t\trow = this._cellsGridArr[iDay];\r\n\t\trowRanges = [];\r\n\t\tfor (iBlock = 0, iBlockLen = row.length; iBlock < iBlockLen; ++iBlock) {\r\n\t\t\tblock = row[iBlock];\r\n\t\t\tif (!outRange) {\r\n\t\t\t\tstateUID = block.attr('data-state') || this._o.stateDefault.uid;\r\n\t\t\t\toutRange = {\r\n\t\t\t\t\ts: stateUID,\r\n\t\t\t\t\tstate: stateUID ? this.model_getState(stateUID) : this._o.stateDefault,\r\n\t\t\t\t\tday: iDay,\r\n\t\t\t\t\tstart: this._convertIndexToHour(iBlock, false),\r\n\t\t\t\t\tstartIndex: iBlock,\r\n\t\t\t\t\tstartBlock: row[iBlock]\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\telse if (block.attr('data-state') !== outRange.s) {\r\n\r\n\t\t\t\tif (outRange.s !== '') {\r\n\t\t\t\t\toutRange.end = this._convertIndexToHour(iBlock, true);\r\n\t\t\t\t\toutRange.endIndex = iBlock - 1;\r\n\t\t\t\t\toutRange.endBlock = row[iBlock - 1];\r\n\t\t\t\t\trowRanges.push(outRange);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstateUID = block.attr('data-state') || this._o.stateDefault.uid;\r\n\t\t\t\toutRange = {\r\n\t\t\t\t\ts: stateUID,\r\n\t\t\t\t\tstate: stateUID ? this.model_getState(stateUID) : this._o.stateDefault,\r\n\t\t\t\t\tday: iDay,\r\n\t\t\t\t\tstart: this._convertIndexToHour(iBlock, false),\r\n\t\t\t\t\tstartIndex: iBlock,\r\n\t\t\t\t\tstartBlock: row[iBlock]\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// if a range is opened --> close and store data\r\n\t\tif (outRange && outRange.s != '') {\r\n\t\t\toutRange.end = this._convertIndexToHour(iBlock, true);\r\n\t\t\toutRange.endIndex = iBlockLen - 1;\r\n\t\t\toutRange.endBlock = row[iBlockLen - 1];\r\n\t\t\trowRanges.push(outRange);\r\n\t\t}\r\n\t\toutRange = null;\r\n\r\n\t\t// copy row ranges\r\n\t\tthis._planning.week[iDay] = [];\r\n\t\tfor (iRange = 0, iRangeLen = rowRanges.length; iRange < iRangeLen; ++iRange) {\r\n\t\t\tthis._planning.ranges.push(rowRanges[iRange]);\r\n\t\t\tthis._planning.week[iDay].push({\r\n\t\t\t\ts: rowRanges[iRange].s,\r\n\t\t\t\tstart: rowRanges[iRange].start,\r\n\t\t\t\tend: rowRanges[iRange].end\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t// console.timeEnd('model_retrieveRanges');\r\n\treturn this._planning;\r\n};\r\n\r\n\r\np._convertHourToIndex = function (s) {\r\n\tvar tokens = s.split(':'),\r\n\t\th = parseInt(tokens[0]),\r\n\t\tm = parseInt(tokens[1]);\r\n\tif (m % (60 / this._o.hourParts) !== 0)\r\n\t\tm += 1;\r\n\treturn (h * this._o.hourParts) + (m / (60 / this._o.hourParts));\r\n};\r\np._convertIndexToHour = function (i, offset) {\r\n\tvar h, m;\r\n\th = Math.floor(i / this._o.hourParts);\r\n\tm = 60 / this._o.hourParts * (i % this._o.hourParts);\r\n\tif (offset === true) {\r\n\t\tm = (m - 1 + 60) % 60;\r\n\t\tif (m === 59)\r\n\t\t\th -= 1;\r\n\t}\r\n\th = (h + 24) % 24;\r\n\r\n\th = h.toString();\r\n\tm = m.toString();\r\n\treturn ((h.length < 2) ? '0' + h : h) + ':' + ((m.length < 2) ? '0' + m : m);\r\n};"]}