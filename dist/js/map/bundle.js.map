{"version":3,"sources":["bundle.js"],"names":["GVPlanning","selector","options","this","_o","Object","assign","feedbackCallback","hourFrom","hourTo","hourParts","days","states","stateDefault","stateSelectedDefault","console","log","model_getState","_cbs","model_setState","bind","ux_unsetHover","ux_colStateWatch","ux_colState","ux_colHover","ux_rowState","ux_rowHover","ux_blockState","ux_blockStateWatch","_state","_rangesRenderLock","_dragStatus","_planning","ranges","week","_domEl","$","addClass","_containerEl","find","_controlsEl","dom_build","on","e","preventDefault","planning","model_restore","p","prototype","ux_error","message","level","button","type","document","window","off","block","row","xBlock","yBlock","selBlocks","min","max","target","parent","index","parseInt","attr","y","x","state","uid","_cellsByDay","slice","dom_setBlocksState","_cellsAll","removeClass","ux_rowSelect","closest","ux_colSelect","selectors","el","hasClass","i","iLen","push","join","classList","blocks","length","dom_renderRanges","str","iRange","iRangeLen","range","self","remove","model_retrieveRanges","day","startBlock","start","end","tipEl","css","width","endBlock","offset","left","appendTo","background-color","color","a","startIndex","endIndex","_cellsGridArr","iDay","iDayLen","classes","dayCells","iHour","iHourMod","iHourLen","label","append","Math","ceil","each","rowIndex","rowEl","blockIndex","blockEl","input","hasOwnProperty","warn","filter","trigger","rowDay","iCell","iCellLen","s","_convertHourToIndex","model_export","settings","JSON","stringify","stateUID","iBlock","iBlockLen","rowRanges","outRange","splice","_convertIndexToHour","tokens","split","h","m","floor","toString"],"mappings":"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","file":"../bundle.js","sourcesContent":["var GVPlanning = function (selector, options) {\r\n\r\n\t// ##########################################\r\n\r\n\t// --- options\r\n\r\n\tthis._o = Object.assign({\r\n\t\tfeedbackCallback: null,\r\n\t\thourFrom: 0,\r\n\t\thourTo: 24,\r\n\t\thourParts: 4,\r\n\t\tdays: [],\r\n\t\tstates: [],\r\n\t\tstateDefault: null,\r\n\t\tstateSelectedDefault: null,\r\n\t}, options);\r\n\r\n\tconsole.log(this._o.stateDefault, typeof this._o.stateDefault);\r\n\tif(this._o.stateDefault == null)\r\n\t\tthis._o.stateDefault = this._o.states[0];\r\n\telse if(typeof this._o.stateDefault == 'string')\r\n\t\tthis._o.stateDefault = this.model_getState(this._o.stateDefault);\r\n\r\n\r\n\t// --- variables initialization\r\n\r\n\tthis._cbs = {\r\n\t\tmodel_setState: this.model_setState.bind(this),\r\n\t\tux_unsetHover: this.ux_unsetHover.bind(this),\r\n\t\tux_colStateWatch: this.ux_colStateWatch.bind(this),\r\n\t\tux_colState: this.ux_colState.bind(this),\r\n\t\tux_colHover: this.ux_colHover.bind(this),\r\n\t\tux_rowState: this.ux_rowState.bind(this),\r\n\t\tux_rowHover: this.ux_rowHover.bind(this),\r\n\t\tux_blockState: this.ux_blockState.bind(this),\r\n\t\tux_blockStateWatch: this.ux_blockStateWatch.bind(this),\r\n\t};\r\n\r\n\tthis._state = null;\r\n\r\n\t// allow developper to lock rendering during extensive update processes\r\n\tthis._rangesRenderLock = false;\r\n\t// while dragging to \"paint\" in block-type cells, store the position of the drag start position\r\n\tthis._dragStatus = null;\r\n\t// store all ranges settings\r\n\tthis._planning = {\r\n\t\tranges: [],\r\n\t\tweek: [],\r\n\t};\r\n\t\r\n\t// ########################################## INIT INSTANCE\r\n\r\n\tthis._domEl = $(selector).addClass('gvp');\r\n\tthis._containerEl = this._domEl.find('.gvp-container');\r\n\tthis._controlsEl = this._domEl.find('.gvp-controls');\r\n\r\n\tthis.dom_build();\r\n\r\n\tthis._containerEl\r\n\t\t// --- complete day\r\n\t\t.on('click', '.gvp__day', this._cbs.ux_rowState)\r\n\t\t.on('mouseover', '.gvp__day', this._cbs.ux_rowHover)\r\n\t\t.on('mouseleave', '.gvp__day', this._cbs.ux_unsetHover)\r\n\t\t// ---\tcomplete hour\r\n\t\t.on('mousedown', '.gvp__hour', this._cbs.ux_colStateWatch)\r\n\t\t.on('mouseover', '.gvp__hour', this._cbs.ux_colHover)\r\n\t\t.on('mouseleave', '.gvp__hour', this._cbs.ux_unsetHover)\r\n\t\t// ---\thour part\r\n\t\t.on('mousedown', '.gvp__hour-part', this._cbs.ux_colStateWatch)\r\n\t\t.on('mouseover', '.gvp__hour-part', this._cbs.ux_colHover)\r\n\t\t.on('mouseleave', '.gvp__hour-part', this._cbs.ux_unsetHover)\r\n\t\t// --- element\r\n\t\t.on('mousedown', '.gvp__block', this._cbs.ux_blockStateWatch)\r\n\t;\r\n\r\n\tthis._domEl.on('dragstart', function(e){\r\n\t\te.preventDefault();\r\n\t\treturn false;\r\n\t});\r\n\tthis._controlsEl\r\n\t\t.on('click', '.gvp-state-selector', this._cbs.model_setState)\r\n\t;\r\n\r\n\r\n\t// --- if a configuration is set ==> display it\r\n\tif (this._o.planning){\r\n\t\tthis.model_restore();\r\n\t}\r\n\tif (this._o.stateSelectedDefault){\r\n\t\tthis.model_setState(this._o.stateSelectedDefault);\r\n\t}\r\n};\r\nvar p = GVPlanning.prototype;\r\n\r\np.ux_error = function (message, level) {\r\n\tif(this._o.feedbackCallback){\r\n\t\tthis._o.feedbackCallback(message, level);\r\n\t}\r\n\tconsole.log('[' + level + ']', message);\r\n};\r\np.ux_blockStateWatch = function (e) {\r\n\tif (!this._state) {\r\n\t\tthis.ux_error('no-state-selected');\r\n\t\treturn;\r\n\t}\r\n\tif (e.button && e.button === 2) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (e.type === 'mousedown') {\r\n\t\tthis._containerEl\r\n\t\t\t.on('mouseover', '.gvp__block', this._cbs.ux_blockState);\r\n\t\t$(document)\r\n\t\t\t.on('mouseup', this._cbs.ux_blockStateWatch);\r\n\t\t$(window)\r\n\t\t\t.on('mouseup', this._cbs.ux_blockStateWatch);\r\n\r\n\t\tthis.ux_blockState(e);\r\n\t}\r\n\telse{\r\n\t\t// release drag lock\r\n\t\tthis._dragStatus = null;\r\n\r\n\t\tthis._containerEl\r\n\t\t\t.off('mouseover', '.gvp__block', this._cbs.ux_blockState);\r\n\t\t$(document)\r\n\t\t\t.off('mouseup', this._cbs.ux_blockStateWatch);\r\n\t\t$(window)\r\n\t\t\t.off('mouseup', this._cbs.ux_blockStateWatch);\r\n\t}\r\n};\r\np.ux_blockState = function (e) {\r\n\tvar block, row, xBlock, yBlock, selBlocks, min, max;\r\n\r\n\tif (!this._state) {\r\n\t\tthis.ux_error('no-state-selected');\r\n\t\treturn;\r\n\t}\r\n\r\n\tblock = $(e.target);\r\n\trow = block.parent('.gvp-row__day');\r\n\txBlock = row.find('.gvp__block').index(block);\r\n\tyBlock = parseInt(row.attr('data-day-index'));\r\n\r\n\tif(!this._dragStatus){\r\n\t\tthis._dragStatus = {\r\n\t\t\tx: xBlock,\r\n\t\t\ty: yBlock,\r\n\t\t\tstate: block.attr('data-state') === this._state.uid ? this._o.stateDefault : this._state\r\n\t\t};\r\n\t}\r\n\telse if(yBlock != this._dragStatus.y){\r\n\t\treturn;\r\n\t}\r\n\r\n\tif(xBlock > this._dragStatus.x){\r\n\t\tmin = this._dragStatus.x;\r\n\t\tmax = xBlock;\r\n\t}\r\n\telse{\r\n\t\tmin = xBlock;\r\n\t\tmax = this._dragStatus.x;\r\n\t}\r\n\tselBlocks = this._cellsByDay[yBlock].slice(min, max + 1);\r\n\tthis.dom_setBlocksState(selBlocks, this._dragStatus.state);\r\n};\r\np.ux_unsetHover = function () {\r\n\tthis._cellsAll.removeClass('gvp--target-hover');\r\n};\r\np.ux_rowSelect = function (e) {\r\n\treturn $(e.target).closest('.gvp-row').find('.gvp__block');\r\n};\r\np.ux_rowHover = function (e) {\r\n\tthis.ux_unsetHover();\r\n\tthis.ux_rowSelect(e).addClass('gvp--target-hover');\r\n};\r\np.ux_rowState = function (e) {\r\n\tif (!this._state) {\r\n\t\tthis.ux_error('no-state-selected');\r\n\t\treturn;\r\n\t}\r\n\tthis.dom_setBlocksState(this.ux_rowSelect(e), this._state);\r\n};\r\n\r\np.ux_colStateWatch = function (e) {\r\n\tvar el = $(e.target),\r\n\t\tindex,\r\n\t\tselectors;\r\n\r\n\tif (e.type === 'mousedown') {\r\n\t\tthis._containerEl\r\n\t\t\t.on('mouseover', '.gvp__hour', this._cbs.ux_colState)\r\n\t\t\t.on('mouseover', '.gvp__hour-part', this._cbs.ux_colState)\r\n\t\t;\r\n\t\t$(document)\r\n\t\t\t.on('mouseup', this._cbs.ux_colStateWatch);\r\n\t\t$(window)\r\n\t\t\t.on('mouseup', this._cbs.ux_colStateWatch);\r\n\t\tthis.ux_colState(e);\r\n\t}\r\n\telse{\r\n\t\tthis._containerEl\r\n\t\t\t.off('mouseover', '.gvp__hour', this._cbs.ux_colState)\r\n\t\t\t.off('mouseover', '.gvp__hour-part', this._cbs.ux_colState)\r\n\t\t;\r\n\t\t$(document)\r\n\t\t\t.off('mouseup', this._cbs.ux_colStateWatch);\r\n\t\t$(window)\r\n\t\t\t.off('mouseup', this._cbs.ux_colStateWatch);\r\n\t}\r\n}\r\np.ux_colSelect = function (e) {\r\n\tvar el = $(e.target), index, selectors;\r\n\r\n\t// ---\tcomplete hour\r\n\tif (el.hasClass('gvp__hour')) {\r\n\t\tindex = el.closest('.gvp-row').find('.gvp__hour').index(el);\r\n\t\tselectors = [];\r\n\t\tfor (var i = index * this._o.hourParts, iLen = i + this._o.hourParts; i < iLen; ++i) {\r\n\t\t\tselectors.push('.gvp__block:eq(' + i + ')');\r\n\t\t}\r\n\t\treturn $('.gvp-row__day').find(selectors.join(', '));\r\n\t}\r\n\t// ---\thour parts\r\n\telse if (el.hasClass('gvp__hour-part')) {\r\n\t\tindex = el.closest('.gvp-row').find('.gvp__hour-part').index(el);\r\n\t\treturn $('.gvp-row__day').find('.gvp__block:eq(' + index + ')');\r\n\t}\r\n\telse{\r\n\t\tconsole.log(el[0].classList, el);\r\n\t}\r\n\treturn $('#void');\r\n};\r\np.ux_colHover = function (e) {\r\n\tthis.ux_unsetHover();\r\n\tthis.ux_colSelect(e).addClass('gvp--target-hover');\r\n};\r\np.ux_colState = function (e) {\r\n\tif (!this._state) {\r\n\t\tthis.ux_error('no-state-selected');\r\n\t\treturn;\r\n\t}\r\n\tthis.dom_setBlocksState(this.ux_colSelect(e), this._state);\r\n};\r\n\r\np.dom_setBlocksState = function (blocks, state) {\r\n\tif (!blocks || blocks.length === 0) {\r\n\t\tthis.ux_error('no-target');\r\n\t\treturn;\r\n\t}\r\n\r\n\tblocks.attr('data-state', state ? state.uid : null);\r\n\r\n\t// render is lock --> skip render\r\n\tif (!this._rangesRenderLock) {\r\n\t\tthis.dom_renderRanges();\r\n\t}\r\n};\r\np.dom_renderRanges = function () {\r\n\tvar self = this,\r\n\t\tstr,\r\n\t\tranges, iRange, iRangeLen, range;\r\n\r\n\t// console.time('dom_renderRanges');\r\n\r\n\t// no drag process running, remove former ranges elements\r\n\tif(this._dragStatus){\r\n\t\tthis._containerEl\r\n\t\t\t.find('.gvp-row__day[data-day-index=\"' + this._dragStatus.y + '\"]')\r\n\t\t\t.find('.gvp__range')\r\n\t\t\t.remove();\r\n\t}\r\n\telse{\r\n\t\tthis._containerEl\r\n\t\t\t.find('.gvp__range')\r\n\t\t\t.remove();\r\n\t}\r\n\r\n\tranges = this.model_retrieveRanges().ranges;\r\n\tfor (iRange = 0, iRangeLen = ranges.length; iRange < iRangeLen; ++iRange) {\r\n\t\trange = ranges[iRange];\r\n\r\n\t\tif(this._dragStatus){\r\n\t\t\tif(range.day !== this._dragStatus.y)\r\n\t\t\t\tcontinue;\r\n\t\t\trange.startBlock.find('.gvp__range').remove();\r\n\t\t}\r\n\r\n\t\t// --- create tooltip instance\r\n\t\tstr = '<div class=\"gvp__range\">';\r\n\t\tstr += '<div class=\"gvp__range-area\"></div>';\r\n\t\tstr += '<div class=\"gvp__range-tooltip\">' + range.start + ' - ' + range.end + '</div>';\r\n\t\tstr += '</div>';\r\n\t\trange.tipEl = $(str);\r\n\r\n\t\trange.tipEl\r\n\t\t\t.css({\r\n\t\t\t\twidth: range.endBlock.offset().left - range.startBlock.offset().left + range.startBlock.width()\r\n\t\t\t})\r\n\t\t\t.appendTo(range.startBlock)\r\n\t\t\t.find('.gvp__range-area')\r\n\t\t\t\t.css({\r\n\t\t\t\t\t'background-color': range.state.color,\r\n\t\t\t\t});\r\n\r\n\t\t(function(range){\r\n\t\t\tfor(var a = range.startIndex; a <= range.endIndex; a++){\r\n\t\t\t\tself._cellsGridArr[range.day][a]\r\n\t\t\t\t\t.on('mouseover', function(){\r\n\t\t\t\t\t\trange.tipEl.addClass('show-tooltip');\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.on('mouseout', function(){\r\n\t\t\t\t\t\trange.tipEl.removeClass('show-tooltip');\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t}(range));\r\n\t}\r\n\r\n\t// console.timeEnd('dom_renderRanges');\r\n};\r\np.dom_build = function () {\r\n\tvar str,\r\n\t\tself = this,\r\n\t\ti, iLen,\r\n\t\tiDay, iDayLen,\r\n\t\tclasses,\r\n\t\tdayCells,\r\n\t\tiHour, iHourMod, iHourLen;\r\n\r\n\r\n\t// ##################### BUILD STATES SELECTORS\r\n\r\n\tstr = '';\r\n\tfor (i = 0, iLen = this._o.states.length; i < iLen; ++i) {\r\n\t\tstr += '<div class=\"gvp-state-selector\" data-state=\"' + this._o.states[i].uid + '\">'\r\n\t\t\t+ '<span class=\"bullet\" style=\"background-color: ' + this._o.states[i].color + ';\"></span>'\r\n\t\t\t+ this._o.states[i].label\r\n\t\t\t+ '</div>';\r\n\t}\r\n\tthis._controlsEl.find('.controls-selectors').append(str);\r\n\r\n\r\n\t// ##################### BUILD GRID\r\n\r\n\tstr = '';\r\n\tiHourLen = 24 * this._o.hourParts;\r\n\r\n\t// ---\thours display\r\n\r\n\tstr += '<div class=\"gvp-row gvp-row__hours\">';\r\n\tstr += '<div></div>';\r\n\tfor (iHour = 0; iHour < iHourLen; iHour++) {\r\n\t\tiHourMod = iHour % this._o.hourParts;\r\n\t\tif (iHourMod === 0) {\r\n\t\t\tstr += '<div class=\"gvp__hour gvp--hour-start';\r\n\t\t\tif(iHour > 0 && (iHour / this._o.hourParts) % 6 == 0){\r\n\t\t\t\tstr += '-xl';\r\n\t\t\t}\r\n\t\t\tstr += '\"><span>' + Math.ceil(iHour / this._o.hourParts) + 'h' + '</span>';\r\n\t\t}\r\n\t\telse if (iHourMod === (this._o.hourParts - 1))\r\n\t\t\tstr += '</div>';\r\n\t}\r\n\tstr += '</div>';\r\n\r\n\r\n\tstr += '<div class=\"gvp-row gvp-row__hour-parts\">';\r\n\tstr += '<div></div>';\r\n\tfor (iHour = 0; iHour < iHourLen; iHour++) {\r\n\t\tstr += '<div class=\"gvp__hour-part';\r\n\t\tif(iHour > 0 && (iHour / this._o.hourParts) % 6 == 0){\r\n\t\t\tstr += ' gvp--hour-start-xl';\r\n\t\t}\r\n\t\tstr += '\"></div>';\r\n\t}\r\n\tstr += '</div>';\r\n\r\n\r\n\t// ---\tdays display\r\n\tfor (iDay = 0, iDayLen = this._o.days.length; iDay < iDayLen; iDay++) {\r\n\t\tstr += '<div class=\"gvp-row gvp-row__day\" data-day-index=\"' + iDay + '\">';\r\n\t\tstr += '<div class=\"gvp__day\">' + this._o.days[iDay] + '</div>';\r\n\t\tfor (iHour = 0; iHour < iHourLen; iHour++) {\r\n\t\t\tclasses = 'gvp__block';\r\n\t\t\tif (iHour % this._o.hourParts === 0) {\r\n\t\t\t\tclasses += (iHour > 0 && ((iHour / this._o.hourParts) % 6 == 0)) ? ' gvp--hour-start-xl' : ' gvp--hour-start';\r\n\t\t\t}\r\n\t\t\tstr += '<div class=\"' + classes + '\"></div>';\r\n\t\t}\r\n\t\tstr += '</div>';\r\n\t}\r\n\r\n\tthis._containerEl.append($(str));\r\n\r\n\r\n\t// --- store all cells\r\n\r\n\tthis._cellsGridArr = [];\r\n\tthis._cellsByDay = [];\r\n\tthis._containerEl.find('.gvp-row__day').each(function (rowIndex, rowEl) {\r\n\t\trowEl = $(rowEl);\r\n\t\tdayCells = [];\r\n\t\trowEl.find('.gvp__block').each(function (blockIndex, blockEl) {\r\n\t\t\tdayCells.push($(blockEl));\r\n\t\t});\r\n\t\tself._cellsGridArr.push(dayCells);\r\n\t\tself._cellsByDay.push(rowEl.find('.gvp__block'));\r\n\t});\r\n\tself._cellsAll = this._containerEl.find('.gvp__block');\r\n};\r\n\r\np.model_getState = function (input) {\r\n\t// retrieve state from event\r\n\tif (typeof input === 'object' && input.hasOwnProperty('target')) {\r\n\t\tinput = $(input.target).attr('data-state');\r\n\t}\r\n\r\n\t// prevent illegal calls\r\n\tif (input === null || typeof input !== 'string') {\r\n\t\tconsole.warn('[GVPlanning.model_setState] Unable to retrieve state from passed-in parameter: ', input);\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfor (var i = 0, iLen = this._o.states.length; i < iLen; ++i) {\r\n\t\tif (this._o.states[i].uid === input) {\r\n\t\t\treturn this._o.states[i];\r\n\t\t}\r\n\t}\r\n\r\n\tconsole.log('[GVPlanning.model_setState] Unable to retrieve state from UID: ', input);\r\n\treturn false;\r\n};\r\np.model_setState = function (state) {\r\n\tstate = this.model_getState(state);\r\n\tif (state === false) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tthis._state = state;\r\n\tthis._controlsEl.find('.gvp-state-selector')\r\n\t\t.removeClass('active')\r\n\t\t.filter('[data-state=\"' + this._state.uid + '\"]').addClass('active');\r\n\tthis._domEl.trigger('stateSelected', {\r\n\t\tstate: this._state\r\n\t});\r\n};\r\np.model_restore = function () {\r\n\tvar\r\n\t\tp = this._o.planning,\r\n\t\tiDay, iDayLen, rowDay,\r\n\t\tiRange, iRangeLen, range, state,\r\n\t\tiCell, iCellLen;\r\n\r\n\tthis._rangesRenderLock = true;\r\n\r\n\t// --- day loop\r\n\tfor (iDay = 0, iDayLen = this._o.days.length; iDay < iDayLen; ++iDay) {\r\n\t\trowDay = this._containerEl.find('.gvp-row__day:eq(' + iDay + ')');\r\n\r\n\t\t// --- range loop\r\n\t\tfor (iRange = 0, iRangeLen = p[iDay].length; iRange < iRangeLen; ++iRange) {\r\n\t\t\trange = p[iDay][iRange];\r\n\t\t\tstate = this.model_getState(range.s);\r\n\r\n\t\t\t// --- cell loop\r\n\t\t\tfor (iCell = this._convertHourToIndex(range.start), iCellLen = this._convertHourToIndex(range.end); iCell < iCellLen; ++iCell) {\r\n\t\t\t\tthis.dom_setBlocksState(rowDay.find('.gvp__block:eq(' + iCell + ')'), state);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tthis._rangesRenderLock = false;\r\n\tthis.dom_renderRanges();\r\n\r\n\tconsole.log('[GVPlanning.model_restore] import completed');\r\n};\r\np.model_export = function () {\r\n\tvar settings = this.model_retrieveRanges();\r\n\tconsole.log('model_export', JSON.stringify(settings.week));\r\n\treturn settings.week;\r\n};\r\np.model_retrieveRanges = function () {\r\n\tvar\r\n\t\tstateUID,\r\n\t\tiDay, iDayLen, row,\r\n\t\tiRange, iRangeLen,\r\n\t\tiBlock, iBlockLen, block,\r\n\t\trowRanges, outRange;\r\n\r\n\t// console.time('model_retrieveRanges');\r\n\r\n\t// --- if a drag process is running remove all ranges belonging to the drag row\r\n\tif(this._dragStatus){\r\n\t\tfor(iRange = this._planning.ranges.length - 1; iRange >= 0; --iRange){\r\n\t\t\tif(this._planning.ranges[iRange].day === this._dragStatus.y){\r\n\t\t\t\tthis._planning.ranges.splice(iRange, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse{\r\n\t\tthis._planning.ranges = [];\r\n\t}\r\n\r\n\tfor (iDay = 0, iDayLen = this._o.days.length; iDay < iDayLen; ++iDay) {\r\n\r\n\t\t// --- if a drag process is running, check only the  drag row\r\n\t\tif(this._dragStatus && this._dragStatus.y !== iDay)\r\n\t\t\tcontinue;\r\n\r\n\t\trow = this._cellsGridArr[iDay];\r\n\t\trowRanges = [];\r\n\t\tfor (iBlock = 0, iBlockLen = row.length; iBlock < iBlockLen; ++iBlock) {\r\n\t\t\tblock = row[iBlock];\r\n\t\t\tif (!outRange) {\r\n\t\t\t\tstateUID = block.attr('data-state') || this._o.stateDefault.uid;\r\n\t\t\t\toutRange = {\r\n\t\t\t\t\ts: stateUID,\r\n\t\t\t\t\tstate: stateUID ? this.model_getState(stateUID) : this._o.stateDefault,\r\n\t\t\t\t\tday: iDay,\r\n\t\t\t\t\tstart: this._convertIndexToHour(iBlock, false),\r\n\t\t\t\t\tstartIndex: iBlock,\r\n\t\t\t\t\tstartBlock: row[iBlock]\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\telse if (block.attr('data-state') !== outRange.s) {\r\n\r\n\t\t\t\tif (outRange.s !== '') {\r\n\t\t\t\t\toutRange.end = this._convertIndexToHour(iBlock, true);\r\n\t\t\t\t\toutRange.endIndex = iBlock - 1;\r\n\t\t\t\t\toutRange.endBlock = row[iBlock - 1];\r\n\t\t\t\t\trowRanges.push(outRange);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstateUID = block.attr('data-state') || this._o.stateDefault.uid;\r\n\t\t\t\toutRange = {\r\n\t\t\t\t\ts: stateUID,\r\n\t\t\t\t\tstate: stateUID ? this.model_getState(stateUID) : this._o.stateDefault,\r\n\t\t\t\t\tday: iDay,\r\n\t\t\t\t\tstart: this._convertIndexToHour(iBlock, false),\r\n\t\t\t\t\tstartIndex: iBlock,\r\n\t\t\t\t\tstartBlock: row[iBlock]\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// if a range is opened --> close and store data\r\n\t\tif (outRange && outRange.s != '') {\r\n\t\t\toutRange.end = this._convertIndexToHour(iBlock, true);\r\n\t\t\toutRange.endIndex = iBlockLen - 1;\r\n\t\t\toutRange.endBlock = row[iBlockLen - 1];\r\n\t\t\trowRanges.push(outRange);\r\n\t\t}\r\n\t\toutRange = null;\r\n\r\n\t\t// copy row ranges\r\n\t\tthis._planning.week[iDay] = [];\r\n\t\tfor (iRange = 0, iRangeLen = rowRanges.length; iRange < iRangeLen; ++iRange) {\r\n\t\t\tthis._planning.ranges.push(rowRanges[iRange]);\r\n\t\t\tthis._planning.week[iDay].push({\r\n\t\t\t\ts: rowRanges[iRange].s,\r\n\t\t\t\tstart: rowRanges[iRange].start,\r\n\t\t\t\tend: rowRanges[iRange].end\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t// console.timeEnd('model_retrieveRanges');\r\n\treturn this._planning;\r\n};\r\n\r\n\r\np._convertHourToIndex = function (s) {\r\n\tvar tokens = s.split(':'),\r\n\t\th = parseInt(tokens[0]),\r\n\t\tm = parseInt(tokens[1]);\r\n\tif (m % (60 / this._o.hourParts) !== 0)\r\n\t\tm += 1;\r\n\treturn (h * this._o.hourParts) + (m / (60 / this._o.hourParts));\r\n};\r\np._convertIndexToHour = function (i, offset) {\r\n\tvar h, m;\r\n\th = Math.floor(i / this._o.hourParts);\r\n\tm = 60 / this._o.hourParts * (i % this._o.hourParts);\r\n\tif (offset === true) {\r\n\t\tm = (m - 1 + 60) % 60;\r\n\t\tif (m === 59)\r\n\t\t\th -= 1;\r\n\t}\r\n\th = (h + 24) % 24;\r\n\r\n\th = h.toString();\r\n\tm = m.toString();\r\n\treturn ((h.length < 2) ? '0' + h : h) + ':' + ((m.length < 2) ? '0' + m : m);\r\n};"]}