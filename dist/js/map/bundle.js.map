{"version":3,"sources":["bundle.js"],"names":["UIPlanning","selector","options","this","_domEl","$","addClass","_containerEl","find","_controlsEl","_feedbackEl","_options","Object","assign","hourFrom","hourTo","hourParts","dayNames","stateDefault","states","_state","_rangesRenderLock","_callbacks","model_setState","bind","ux_releaseHover","ux_columnState","ux_columnHover","ux_rowState","ux_rowHover","ux_blockState","ux_blockStateMouseState","model_export","model_restore","dom_build","_allBlocks","ux_interactions","planning","dom_setBlocksState","dom_renderRanges","prototype","on","ux_displayError","message","html","e","button","type","document","target","is","off","removeClass","ux_rowSelect","closest","ux_columnSelect","index","selectors","el","i","iLen","push","join","blocks","state","length","attr","uid","console","log","str","ranges","iRange","iRangeLen","range","self","remove","model_retrieveRanges","start","end","tipEl","css","width","endBlock","offset","left","startBlock","appendTo","background-color","color","a","startIndex","endIndex","_cells","day","iDay","classes","dayCells","iHour","iHourMod","iHourLen","label","append","Math","ceil","each","rowIndex","rowEl","blockIndex","blockEl","model_retrieveState","input","hasOwnProperty","filter","trigger","rowDay","iCell","iCellLen","p","s","_convertHourToIndex","settings","JSON","stringify","week","iRow","iRowLen","row","iBlock","iBlockLen","block","rowRanges","outRange","out","_convertIndexToHour","tokens","split","h","parseInt","m","floor","toString"],"mappings":"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","file":"../bundle.js","sourcesContent":["var UIPlanning = function (selector, options) {\r\n\r\n\tthis._domEl = $(selector);\r\n\tthis._domEl.addClass('gv-planning');\r\n\r\n\tthis._containerEl = this._domEl.find('.planning-container');\r\n\tthis._controlsEl = this._domEl.find('.planning-controls');\r\n\tthis._feedbackEl = this._domEl.find('.planning-feedback');\r\n\r\n\tthis._options = Object.assign({\r\n\t\thourFrom: 0,\r\n\t\thourTo: 24,\r\n\t\thourParts: 4,\r\n\t\tdayNames: ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'],\r\n\t\tstateDefault: null,\r\n\t\tstates: []\r\n\t}, options);\r\n\r\n\tthis._state = null;\r\n\t/** @var boolean   allow developper to lock rendering during extensive update processes */\r\n\tthis._rangesRenderLock = true;\r\n\r\n\tthis._callbacks = {\r\n\t\tmodel_setState: this.model_setState.bind(this),\r\n\t\tux_releaseHover: this.ux_releaseHover.bind(this),\r\n\t\tux_columnState: this.ux_columnState.bind(this),\r\n\t\tux_columnHover: this.ux_columnHover.bind(this),\r\n\t\tux_rowState: this.ux_rowState.bind(this),\r\n\t\tux_rowHover: this.ux_rowHover.bind(this),\r\n\t\tux_blockState: this.ux_blockState.bind(this),\r\n\t\tux_blockStateMouseState: this.ux_blockStateMouseState.bind(this),\r\n\t\tmodel_export: this.model_export.bind(this),\r\n\t\tmodel_restore: this.model_restore.bind(this)\r\n\t};\r\n\r\n\r\n\t// ############## init\r\n\r\n\tthis.dom_build();\r\n\tthis._allBlocks = this._containerEl.find('.uiplanning__block');\r\n\r\n\tthis.ux_interactions();\r\n\r\n\t// --- if a configuration is set ==> display it\r\n\tif (this._options.planning !== null) {\r\n\t\tthis.model_restore();\r\n\t\tif (this._options.stateDefault !== null) {\r\n\t\t\tthis.model_setState(this._options.stateDefault);\r\n\t\t}\r\n\t}\r\n\r\n\t// if a default state is set ==> fill all block with it\r\n\telse if (this._options.stateDefault !== null) {\r\n\t\tthis.model_setState(this._options.stateDefault);\r\n\t\tthis.dom_setBlocksState(this._allBlocks, this._state);\r\n\t}\r\n\r\n\r\n\tthis._rangesRenderLock = false;\r\n\tthis.dom_renderRanges();\r\n};\r\n\r\nUIPlanning.prototype.ux_interactions = function () {\r\n\tthis._containerEl\r\n\r\n\t// --- complete day\r\n\t\t.on('click', '.uiplanning__day', this._callbacks.ux_rowState)\r\n\t\t.on('mouseenter', '.uiplanning__day', this._callbacks.ux_rowHover)\r\n\t\t.on('mouseleave', '.uiplanning__day', this._callbacks.ux_releaseHover)\r\n\r\n\t\t// ---\tcomplete hour\r\n\t\t.on('click', '.uiplanning__hour', this._callbacks.ux_columnState)\r\n\t\t.on('mouseenter', '.uiplanning__hour', this._callbacks.ux_columnHover)\r\n\t\t.on('mouseleave', '.uiplanning__hour', this._callbacks.ux_releaseHover)\r\n\r\n\t\t// ---\thour part\r\n\t\t.on('click', '.uiplanning__hour-part', this._callbacks.ux_columnState)\r\n\t\t.on('mouseenter', '.uiplanning__hour-part', this._callbacks.ux_columnHover)\r\n\t\t.on('mouseleave', '.uiplanning__hour-part', this._callbacks.ux_releaseHover)\r\n\r\n\t\t// --- element\r\n\t\t.on('mousedown', '.uiplanning__block', this._callbacks.ux_blockStateMouseState)\r\n\t;\r\n\r\n\tthis._controlsEl\r\n\t\t.on('click', '.planning-state-selector', this._callbacks.model_setState)\r\n\t\t.on('click', '#planning-export', this._callbacks.model_export)\r\n\t\t.on('click', '#planning-restore', this._callbacks.model_restore)\r\n\t;\r\n};\r\nUIPlanning.prototype.ux_displayError = function (message) {\r\n\tthis._feedbackEl.html(message);\r\n};\r\n\r\nUIPlanning.prototype.ux_blockStateMouseState = function (e) {\r\n\tif (!this._state) {\r\n\t\tthis.ux_displayError('no-state-selected');\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (e.button && e.button === 2) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (e.type === 'mousedown') {\r\n\t\tthis._containerEl.on('mouseenter', '.uiplanning__block', this._callbacks.ux_blockState);\r\n\t\t$(document).on('mouseup', this._callbacks.ux_blockStateMouseState);\r\n\t\tif ($(e.target).is('.uiplanning__block')) {\r\n\t\t\tthis.ux_blockState(e);\r\n\t\t}\r\n\t}\r\n\telse if (e.type === 'mouseup') {\r\n\t\tthis._containerEl.off('mouseenter', '.uiplanning__block', this._callbacks.ux_blockState);\r\n\t\t$(document).off('mouseup', this._callbacks.ux_blockStateMouseState);\r\n\t}\r\n};\r\nUIPlanning.prototype.ux_blockState = function (e) {\r\n\tif (!this._state) {\r\n\t\tthis.ux_displayError('no-state-selected');\r\n\t\treturn;\r\n\t}\r\n\r\n\tthis.dom_setBlocksState($(e.target), this._state);\r\n};\r\n\r\nUIPlanning.prototype.ux_releaseHover = function () {\r\n\tthis._allBlocks.removeClass('uiplanning--target-hover');\r\n};\r\n\r\nUIPlanning.prototype.ux_rowSelect = function (e) {\r\n\treturn $(e.target).closest('.uiplanning-row').find('.uiplanning__block');\r\n};\r\nUIPlanning.prototype.ux_rowHover = function (e) {\r\n\tthis.ux_releaseHover();\r\n\tthis.ux_rowSelect(e).addClass('uiplanning--target-hover');\r\n};\r\nUIPlanning.prototype.ux_rowState = function (e) {\r\n\tif (!this._state) {\r\n\t\tthis.ux_displayError('no-state-selected');\r\n\t\treturn;\r\n\t}\r\n\tthis.dom_setBlocksState(this.ux_rowSelect(e), this._state);\r\n};\r\n\r\nUIPlanning.prototype.ux_columnSelect = function (e) {\r\n\tvar el = $(e.target), index, selectors;\r\n\r\n\t// ---\tcomplete hour\r\n\tif (el.is('.uiplanning__hour')) {\r\n\t\tindex = el.closest('.uiplanning-row').find('.uiplanning__hour').index(el);\r\n\t\tselectors = [];\r\n\t\tfor (var i = index * this._options.hourParts, iLen = i + this._options.hourParts; i < iLen; ++i) {\r\n\t\t\tselectors.push('.uiplanning__block:eq(' + i + ')');\r\n\t\t}\r\n\t\treturn $('.uiplanning-row__day').find(selectors.join(', '));\r\n\t}\r\n\t// ---\thour parts\r\n\telse if (el.is('.uiplanning__hour-part')) {\r\n\t\tindex = el.closest('.uiplanning-row').find('.uiplanning__hour-part').index(el);\r\n\t\treturn $('.uiplanning-row__day').find('.uiplanning__block:eq(' + index + ')');\r\n\r\n\t}\r\n};\r\nUIPlanning.prototype.ux_columnHover = function (e) {\r\n\tthis.ux_releaseHover();\r\n\tthis.ux_columnSelect(e).addClass('uiplanning--target-hover');\r\n};\r\nUIPlanning.prototype.ux_columnState = function (e) {\r\n\tif (!this._state) {\r\n\t\tthis.ux_displayError('no-state-selected');\r\n\t\treturn;\r\n\t}\r\n\tthis.dom_setBlocksState(this.ux_columnSelect(e), this._state);\r\n};\r\n\r\nUIPlanning.prototype.dom_setBlocksState = function (blocks, state) {\r\n\tif (!blocks || blocks.length === 0) {\r\n\t\tconsole.log('no-target');\r\n\t\treturn;\r\n\t}\r\n\r\n\tblocks.attr('data-state', state ? state.uid : null);\r\n\r\n\t// render is lock --> skip render\r\n\tif (!this._rangesRenderLock) {\r\n\t\tthis.dom_renderRanges();\r\n\t}\r\n};\r\nUIPlanning.prototype.dom_renderRanges = function () {\r\n\tvar self = this,\r\n\t\tstr,\r\n\t\tranges, iRange, iRangeLen, range;\r\n\r\n\t// --- clear former state\r\n\tthis._containerEl.find('.uiplanning__range').remove();\r\n\r\n\tranges = this.model_retrieveRanges().ranges;\r\n\tfor (iRange = 0, iRangeLen = ranges.length; iRange < iRangeLen; ++iRange) {\r\n\t\trange = ranges[iRange];\r\n\r\n\t\t// --- create tooltip instance\r\n\t\tstr = '';\r\n\t\tstr += '<div class=\"uiplanning__range\">';\r\n\t\tstr += '<div class=\"uiplanning__range-area\"></div>';\r\n\t\tstr += '<div class=\"uiplanning__range-tooltip\">' + range.start + ' - ' + range.end + '</div>';\r\n\t\tstr += '</div>';\r\n\t\trange.tipEl = $(str);\r\n\r\n\t\trange.tipEl\r\n\t\t\t.css({\r\n\t\t\t\twidth: range.endBlock.offset().left - range.startBlock.offset().left + range.startBlock.width()\r\n\t\t\t})\r\n\t\t\t.appendTo(range.startBlock)\r\n\t\t\t.find('.uiplanning__range-area')\r\n\t\t\t\t.css({\r\n\t\t\t\t\t'background-color': range.state.color,\r\n\t\t\t\t});\r\n\r\n\t\t(function(range){\r\n\t\t\tfor(var a = range.startIndex; a <= range.endIndex; a++){\r\n\t\t\t\tself._cells[range.day][a]\r\n\t\t\t\t\t.on('mouseover', function(){\r\n\t\t\t\t\t\trange.tipEl.addClass('show-tooltip');\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.on('mouseout', function(){\r\n\t\t\t\t\t\trange.tipEl.removeClass('show-tooltip');\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t}(range));\r\n\t}\r\n};\r\nUIPlanning.prototype.dom_build = function () {\r\n\tvar str,\r\n\t\tself = this,\r\n\t\ti, iLen,\r\n\t\tiDay,\r\n\t\tclasses,\r\n\t\tdayCells,\r\n\t\tiHour, iHourMod, iHourLen;\r\n\r\n\r\n\t// ##################### BUILD STATES SELECTORS\r\n\r\n\tstr = '';\r\n\tfor (i = 0, iLen = this._options.states.length; i < iLen; ++i) {\r\n\t\tstr += '<div class=\"planning-state-selector\" data-state=\"' + this._options.states[i].uid + '\">'\r\n\t\t\t+ '<span class=\"bullet\" style=\"background-color: ' + this._options.states[i].color + ';\"></span>'\r\n\t\t\t+ this._options.states[i].label\r\n\t\t\t+ '</div>';\r\n\t}\r\n\tthis._controlsEl.find('.controls-selectors').append(str);\r\n\r\n\r\n\t// ##################### BUILD GRID\r\n\r\n\tstr = '';\r\n\tiHourLen = 24 * this._options.hourParts;\r\n\r\n\t// ---\thours display\r\n\r\n\tstr += '<div class=\"uiplanning-row uiplanning-row__hours\">';\r\n\tstr += '<div></div>';\r\n\tfor (iHour = 0; iHour < iHourLen; iHour++) {\r\n\t\tiHourMod = iHour % this._options.hourParts;\r\n\t\tif (iHourMod === 0)\r\n\t\t\tstr += '<div class=\"uiplanning__hour\">' + Math.ceil(iHour / this._options.hourParts) + 'h';\r\n\t\telse if (iHourMod === (this._options.hourParts - 1))\r\n\t\t\tstr += '</div>';\r\n\t}\r\n\tstr += '</div>';\r\n\r\n\r\n\tstr += '<div class=\"uiplanning-row uiplanning-row__hour-parts\">';\r\n\tstr += '<div></div>';\r\n\tfor (iHour = 0; iHour < iHourLen; iHour++) {\r\n\t\tstr += '<div class=\"uiplanning__hour-part\"></div>';\r\n\t}\r\n\tstr += '</div>';\r\n\r\n\r\n\t// ---\tdays display\r\n\tfor (iDay = 0; iDay < 7; iDay++) {\r\n\t\tstr += '<div class=\"uiplanning-row uiplanning-row__day\">';\r\n\t\tstr += '<div class=\"uiplanning__day\">' + this._options.dayNames[iDay] + '</div>';\r\n\t\tfor (iHour = 0; iHour < iHourLen; iHour++) {\r\n\t\t\tiHourMod = iHour % this._options.hourParts;\r\n\t\t\tclasses = 'uiplanning__block';\r\n\t\t\tif (iHourMod === 0) {\r\n\t\t\t\tclasses += ' uiplanning--hour-start';\r\n\t\t\t}\r\n\t\t\tstr += '<div class=\"' + classes + '\">'\r\n\t\t\t\t+ '<div class=\"uiplanning__block-content\"></div>'\r\n\t\t\t\t+ '</div>';\r\n\t\t}\r\n\t\tstr += '</div>';\r\n\t}\r\n\r\n\tthis._containerEl.append($(str));\r\n\r\n\r\n\t// --- store all cells\r\n\r\n\tthis._cells = [];\r\n\tthis._containerEl.find('.uiplanning-row__day').each(function (rowIndex, rowEl) {\r\n\t\trowEl = $(rowEl);\r\n\t\tdayCells = [];\r\n\t\trowEl.find('.uiplanning__block').each(function (blockIndex, blockEl) {\r\n\t\t\tdayCells.push($(blockEl));\r\n\t\t});\r\n\t\tself._cells.push(dayCells);\r\n\t});\r\n};\r\n\r\nUIPlanning.prototype.model_retrieveState = function (input) {\r\n\t// retrieve state from event\r\n\tif (typeof input === 'object' && input.hasOwnProperty('target')) {\r\n\t\tinput = $(input.target).attr('data-state');\r\n\t}\r\n\r\n\t// prevent illegal calls\r\n\tif (input === null || typeof input !== 'string') {\r\n\t\tconsole.log('[UIPlanning.model_setState] Unable to retrieve state from passed-in parameter: ', input);\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfor (var i = 0, iLen = this._options.states.length; i < iLen; ++i) {\r\n\t\tif (this._options.states[i].uid === input) {\r\n\t\t\treturn this._options.states[i];\r\n\t\t}\r\n\t}\r\n\r\n\tconsole.log('[UIPlanning.model_setState] Unable to retrieve state from UID: ', input);\r\n\treturn false;\r\n};\r\nUIPlanning.prototype.model_setState = function (state) {\r\n\tstate = this.model_retrieveState(state);\r\n\tif (state === false) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tthis._state = state;\r\n\tthis._controlsEl.find('.planning-state-selector')\r\n\t\t.removeClass('active')\r\n\t\t.filter('[data-state=\"' + this._state.uid + '\"]').addClass('active');\r\n\tthis._domEl.trigger('stateSelected', {\r\n\t\tstate: this._state\r\n\t});\r\n};\r\nUIPlanning.prototype.model_restore = function () {\r\n\tvar\r\n\t\tp = this._options.planning,\r\n\t\tiDay, rowDay,\r\n\t\tiRange, iRangeLen, range, state,\r\n\t\tiCell, iCellLen;\r\n\r\n\tif (this._options.stateDefault !== null) {\r\n\t\tthis.dom_setBlocksState(this._allBlocks, this.model_retrieveState(this._options.stateDefault));\r\n\t}\r\n\r\n\t// --- day loop\r\n\tfor (iDay = 0; iDay < 7; ++iDay) {\r\n\t\trowDay = this._containerEl.find('.uiplanning-row__day:eq(' + iDay + ')');\r\n\r\n\t\t// --- range loop\r\n\t\tfor (iRange = 0, iRangeLen = p[iDay].length; iRange < iRangeLen; ++iRange) {\r\n\t\t\trange = p[iDay][iRange];\r\n\t\t\tstate = this.model_retrieveState(range.s);\r\n\r\n\t\t\t// --- cell loop\r\n\t\t\tfor (iCell = this._convertHourToIndex(range.start), iCellLen = this._convertHourToIndex(range.end); iCell < iCellLen; ++iCell) {\r\n\t\t\t\tthis.dom_setBlocksState(rowDay.find('.uiplanning__block:eq(' + iCell + ')'), state);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tconsole.log('[UIPlanning.model_restore] import completed');\r\n};\r\nUIPlanning.prototype.model_export = function () {\r\n\tvar settings = this.model_retrieveRanges();\r\n\tconsole.log('model_export', JSON.stringify(settings.week));\r\n\treturn settings.week;\r\n};\r\nUIPlanning.prototype.model_retrieveRanges = function () {\r\n\tvar\r\n\t\tiRow, iRowLen, row,\r\n\t\tiRange, iRangeLen,\r\n\t\tiBlock, iBlockLen, block,\r\n\t\tout = {\r\n\t\t\tranges: [],\r\n\t\t\tweek: []\r\n\t\t},\r\n\t\trowRanges, outRange;\r\n\r\n\t// console.time('model_retrieveRanges');\r\n\tfor (iRow = 0, iRowLen = this._cells.length; iRow < iRowLen; ++iRow) {\r\n\t\trow = this._cells[iRow];\r\n\t\trowRanges = [];\r\n\t\tfor (iBlock = 0, iBlockLen = row.length; iBlock < iBlockLen; ++iBlock) {\r\n\t\t\tblock = row[iBlock];\r\n\r\n\t\t\tif (!outRange) {\r\n\t\t\t\toutRange = {\r\n\t\t\t\t\ts: block.attr('data-state'),\r\n\t\t\t\t\tstate: this.model_retrieveState(block.attr('data-state')),\r\n\t\t\t\t\tday: iRow,\r\n\t\t\t\t\tstart: this._convertIndexToHour(iBlock, false),\r\n\t\t\t\t\tstartIndex: iBlock,\r\n\t\t\t\t\tstartBlock: row[iBlock]\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\telse if (block.attr('data-state') !== outRange.s) {\r\n\r\n\t\t\t\tif (outRange.s !== '') {\r\n\t\t\t\t\toutRange.end = this._convertIndexToHour(iBlock, true);\r\n\t\t\t\t\toutRange.endIndex = iBlock - 1;\r\n\t\t\t\t\toutRange.endBlock = row[iBlock - 1];\r\n\t\t\t\t\trowRanges.push(outRange);\r\n\t\t\t\t}\r\n\r\n\t\t\t\toutRange = {\r\n\t\t\t\t\ts: block.attr('data-state'),\r\n\t\t\t\t\tstate: this.model_retrieveState(block.attr('data-state')),\r\n\t\t\t\t\tday: iRow,\r\n\t\t\t\t\tstart: this._convertIndexToHour(iBlock, false),\r\n\t\t\t\t\tstartIndex: iBlock,\r\n\t\t\t\t\tstartBlock: row[iBlock]\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// if a range is opened --> close and store data\r\n\t\tif (outRange && outRange.s != '') {\r\n\t\t\toutRange.end = this._convertIndexToHour(iBlock, true);\r\n\t\t\toutRange.endIndex = iBlockLen - 1;\r\n\t\t\toutRange.endBlock = row[iBlockLen - 1];\r\n\t\t\trowRanges.push(outRange);\r\n\t\t}\r\n\t\toutRange = null;\r\n\r\n\t\t// copy row ranges\r\n\t\tout.week[iRow] = [];\r\n\t\tfor (iRange = 0, iRangeLen = rowRanges.length; iRange < iRangeLen; ++iRange) {\r\n\t\t\tout.ranges.push(rowRanges[iRange]);\r\n\t\t\tout.week[iRow].push({\r\n\t\t\t\ts: rowRanges[iRange].s,\r\n\t\t\t\tstart: rowRanges[iRange].start,\r\n\t\t\t\tend: rowRanges[iRange].end\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t// console.timeEnd('model_retrieveRanges');\r\n\treturn out;\r\n};\r\n\r\n\r\nUIPlanning.prototype._convertHourToIndex = function (s) {\r\n\tvar tokens = s.split(':'),\r\n\t\th = parseInt(tokens[0]),\r\n\t\tm = parseInt(tokens[1]);\r\n\tif (m % (60 / this._options.hourParts) !== 0)\r\n\t\tm += 1;\r\n\treturn (h * this._options.hourParts) + (m / (60 / this._options.hourParts));\r\n};\r\nUIPlanning.prototype._convertIndexToHour = function (i, offset) {\r\n\tvar h, m, s;\r\n\th = Math.floor(i / this._options.hourParts);\r\n\tm = 60 / this._options.hourParts * (i % this._options.hourParts);\r\n\tif (offset === true) {\r\n\t\tm = (m - 1 + 60) % 60;\r\n\t\tif (m === 59)\r\n\t\t\th -= 1;\r\n\t}\r\n\th = (h + 24) % 24;\r\n\r\n\th = h.toString();\r\n\tm = m.toString();\r\n\r\n\ts = '';\r\n\ts += (h.length < 2) ? '0' + h : h;\r\n\ts += ':';\r\n\ts += (m.length < 2) ? '0' + m : m;\r\n\treturn s;\r\n};\r\n"]}