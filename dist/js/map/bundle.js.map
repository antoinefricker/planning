{"version":3,"sources":["bundle.js"],"names":["GVPlanning","selector","options","this","_o","Object","assign","feedbackCallback","hourFrom","hourTo","hourParts","days","states","stateDefault","stateSelectedDefault","model_getState","_cbs","model_setState","bind","ux_unsetHover","ux_colStateWatch","ux_colState","ux_colHover","ux_rowState","ux_rowHover","ux_blockState","ux_blockStateWatch","_state","_rangesRenderLock","_dragStatus","_planning","ranges","week","_domEl","$","addClass","_containerEl","find","_controlsEl","dom_build","on","e","preventDefault","planning","model_restore","p","prototype","ux_error","message","type","level","console","log","button","document","window","state","off","block","blockState","row","xBlock","yBlock","selBlocks","min","max","target","parent","index","parseInt","attr","y","x","uid","_cellsByDay","slice","dom_setBlocksState","_cellsAll","removeClass","ux_rowSelect","closest","ux_colSelect","selectors","el","hasClass","i","iLen","push","join","classList","blocks","length","dom_renderRanges","str","iRange","iRangeLen","range","self","remove","model_retrieveRanges","day","startBlock","start","end","tipEl","css","width","endBlock","offset","left","appendTo","background-color","color","a","startIndex","endIndex","_cellsGridArr","iDay","iDayLen","classes","dayCells","iHour","iHourMod","iHourLen","label","append","Math","ceil","each","rowIndex","rowEl","blockIndex","blockEl","input","hasOwnProperty","warn","filter","trigger","rowDay","iCell","iCellLen","s","_convertHourToIndex","model_export","settings","JSON","stringify","stateUID","iBlock","iBlockLen","rowRanges","outRange","splice","_convertIndexToHour","tokens","split","h","m","floor","toString"],"mappings":"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","file":"../bundle.js","sourcesContent":["var GVPlanning = function (selector, options) {\r\n\r\n\t// ##########################################\r\n\r\n\t// --- options\r\n\r\n\tthis._o = Object.assign({\r\n\t\tfeedbackCallback: null,\r\n\t\thourFrom: 0,\r\n\t\thourTo: 24,\r\n\t\thourParts: 4,\r\n\t\tdays: [],\r\n\t\tstates: [],\r\n\t\tstateDefault: null,\r\n\t\tstateSelectedDefault: null,\r\n\t}, options);\r\n\r\n\tif(this._o.stateDefault == null)\r\n\t\tthis._o.stateDefault = this._o.states[0];\r\n\telse if(typeof this._o.stateDefault == 'string')\r\n\t\tthis._o.stateDefault = this.model_getState(this._o.stateDefault);\r\n\r\n\r\n\t// --- variables initialization\r\n\r\n\tthis._cbs = {\r\n\t\tmodel_setState: this.model_setState.bind(this),\r\n\t\tux_unsetHover: this.ux_unsetHover.bind(this),\r\n\t\tux_colStateWatch: this.ux_colStateWatch.bind(this),\r\n\t\tux_colState: this.ux_colState.bind(this),\r\n\t\tux_colHover: this.ux_colHover.bind(this),\r\n\t\tux_rowState: this.ux_rowState.bind(this),\r\n\t\tux_rowHover: this.ux_rowHover.bind(this),\r\n\t\tux_blockState: this.ux_blockState.bind(this),\r\n\t\tux_blockStateWatch: this.ux_blockStateWatch.bind(this),\r\n\t};\r\n\r\n\tthis._state = null;\r\n\r\n\t// allow developper to lock rendering during extensive update processes\r\n\tthis._rangesRenderLock = false;\r\n\t// while dragging to \"paint\" in block-type cells, store the position of the drag start position\r\n\tthis._dragStatus = null;\r\n\t// store all ranges settings\r\n\tthis._planning = {\r\n\t\tranges: [],\r\n\t\tweek: [],\r\n\t};\r\n\t\r\n\t// ########################################## INIT INSTANCE\r\n\r\n\tthis._domEl = $(selector).addClass('gvp');\r\n\tthis._containerEl = this._domEl.find('.gvp-container');\r\n\tthis._controlsEl = this._domEl.find('.gvp-controls');\r\n\r\n\tthis.dom_build();\r\n\r\n\tthis._containerEl\r\n\t\t// --- complete day\r\n\t\t.on('click', '.gvp__day', this._cbs.ux_rowState)\r\n\t\t.on('mouseover', '.gvp__day', this._cbs.ux_rowHover)\r\n\t\t.on('mouseleave', '.gvp__day', this._cbs.ux_unsetHover)\r\n\t\t// ---\tcomplete hour\r\n\t\t.on('mousedown', '.gvp__hour', this._cbs.ux_colStateWatch)\r\n\t\t.on('mouseover', '.gvp__hour', this._cbs.ux_colHover)\r\n\t\t.on('mouseleave', '.gvp__hour', this._cbs.ux_unsetHover)\r\n\t\t// ---\thour part\r\n\t\t.on('mousedown', '.gvp__hour-part', this._cbs.ux_colStateWatch)\r\n\t\t.on('mouseover', '.gvp__hour-part', this._cbs.ux_colHover)\r\n\t\t.on('mouseleave', '.gvp__hour-part', this._cbs.ux_unsetHover)\r\n\t\t// --- element\r\n\t\t.on('mousedown', '.gvp__block', this._cbs.ux_blockStateWatch)\r\n\t;\r\n\r\n\tthis._domEl.on('dragstart', function(e){\r\n\t\te.preventDefault();\r\n\t\treturn false;\r\n\t});\r\n\tthis._controlsEl\r\n\t\t.on('click', '.gvp-state-selector', this._cbs.model_setState)\r\n\t;\r\n\r\n\r\n\t// --- if a configuration is set ==> display it\r\n\tif (this._o.planning){\r\n\t\tthis.model_restore();\r\n\t}\r\n\tif (this._o.stateSelectedDefault){\r\n\t\tthis.model_setState(this._o.stateSelectedDefault);\r\n\t}\r\n};\r\nvar p = GVPlanning.prototype;\r\n\r\np.ux_error = function (message, type) {\r\n\tif(this._o.feedbackCallback){\r\n\t\tthis._o.feedbackCallback(message, level);\r\n\t}\r\n\tconsole.log('[' + level + ']', message);\r\n};\r\np.ux_blockStateWatch = function (e) {\r\n\tif (!this._state) {\r\n\t\tthis.ux_error('no-state-selected', 'info');\r\n\t\treturn;\r\n\t}\r\n\tif (e.button && e.button === 2) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (e.type === 'mousedown') {\r\n\t\tthis._containerEl\r\n\t\t\t.on('mouseover', '.gvp__block', this._cbs.ux_blockState);\r\n\t\t$(document)\r\n\t\t\t.on('mouseup', this._cbs.ux_blockStateWatch);\r\n\t\t$(window)\r\n\t\t\t.on('mouseup', this._cbs.ux_blockStateWatch);\r\n\r\n\t\tthis.ux_blockState(e);\r\n\t}\r\n\telse{\r\n\t\t// ckec for state restoration\r\n\t\tif(this._dragStatus.state)\r\n\t\t\tthis.model_setState(this._dragStatus.state);\r\n\t\t// release drag lock\r\n\t\tthis._dragStatus = null;\r\n\r\n\t\tthis._containerEl\r\n\t\t\t.off('mouseover', '.gvp__block', this._cbs.ux_blockState);\r\n\t\t$(document)\r\n\t\t\t.off('mouseup', this._cbs.ux_blockStateWatch);\r\n\t\t$(window)\r\n\t\t\t.off('mouseup', this._cbs.ux_blockStateWatch);\r\n\t}\r\n};\r\np.ux_blockState = function (e) {\r\n\tvar block, blockState, row, xBlock, yBlock, selBlocks, min, max;\r\n\r\n\tif (!this._state) {\r\n\t\tthis.ux_error('no-state-selected', 'info');\r\n\t\treturn;\r\n\t}\r\n\r\n\tblock = $(e.target);\r\n\trow = block.parent('.gvp-row__day');\r\n\txBlock = row.find('.gvp__block').index(block);\r\n\tyBlock = parseInt(row.attr('data-day-index'));\r\n\r\n\tif(!this._dragStatus){\r\n\t\tthis._dragStatus = {\r\n\t\t\tx: xBlock,\r\n\t\t\ty: yBlock,\r\n\t\t};\r\n\t\tblockState = block.attr('data-state');\r\n\t\tif(blockState === this._state.uid){\r\n\t\t\tthis.model_setState(this._o.stateDefault.uid);\r\n\t\t\tthis._dragStatus.state = blockState;\r\n\t\t}\r\n\t}\r\n\telse if(yBlock != this._dragStatus.y){\r\n\t\treturn;\r\n\t}\r\n\r\n\tif(xBlock > this._dragStatus.x){\r\n\t\tmin = this._dragStatus.x;\r\n\t\tmax = xBlock;\r\n\t}\r\n\telse{\r\n\t\tmin = xBlock;\r\n\t\tmax = this._dragStatus.x;\r\n\t}\r\n\tselBlocks = this._cellsByDay[yBlock].slice(min, max + 1);\r\n\tthis.dom_setBlocksState(selBlocks, this._state);\r\n};\r\np.ux_unsetHover = function () {\r\n\tthis._cellsAll.removeClass('gvp--target-hover');\r\n};\r\np.ux_rowSelect = function (e) {\r\n\treturn $(e.target).closest('.gvp-row').find('.gvp__block');\r\n};\r\np.ux_rowHover = function (e) {\r\n\tthis.ux_unsetHover();\r\n\tthis.ux_rowSelect(e).addClass('gvp--target-hover');\r\n};\r\np.ux_rowState = function (e) {\r\n\tif (!this._state) {\r\n\t\tthis.ux_error('no-state-selected', 'info');\r\n\t\treturn;\r\n\t}\r\n\tthis.dom_setBlocksState(this.ux_rowSelect(e), this._state);\r\n};\r\n\r\np.ux_colStateWatch = function (e) {\r\n\tvar el = $(e.target),\r\n\t\tindex,\r\n\t\tselectors;\r\n\r\n\tif (e.type === 'mousedown') {\r\n\t\tthis._containerEl\r\n\t\t\t.on('mouseover', '.gvp__hour', this._cbs.ux_colState)\r\n\t\t\t.on('mouseover', '.gvp__hour-part', this._cbs.ux_colState)\r\n\t\t;\r\n\t\t$(document)\r\n\t\t\t.on('mouseup', this._cbs.ux_colStateWatch);\r\n\t\t$(window)\r\n\t\t\t.on('mouseup', this._cbs.ux_colStateWatch);\r\n\t\tthis.ux_colState(e);\r\n\t}\r\n\telse{\r\n\t\tthis._containerEl\r\n\t\t\t.off('mouseover', '.gvp__hour', this._cbs.ux_colState)\r\n\t\t\t.off('mouseover', '.gvp__hour-part', this._cbs.ux_colState)\r\n\t\t;\r\n\t\t$(document)\r\n\t\t\t.off('mouseup', this._cbs.ux_colStateWatch);\r\n\t\t$(window)\r\n\t\t\t.off('mouseup', this._cbs.ux_colStateWatch);\r\n\t}\r\n}\r\np.ux_colSelect = function (e) {\r\n\tvar el = $(e.target), index, selectors;\r\n\r\n\t// ---\tcomplete hour\r\n\tif (el.hasClass('gvp__hour')) {\r\n\t\tindex = el.closest('.gvp-row').find('.gvp__hour').index(el);\r\n\t\tselectors = [];\r\n\t\tfor (var i = index * this._o.hourParts, iLen = i + this._o.hourParts; i < iLen; ++i) {\r\n\t\t\tselectors.push('.gvp__block:eq(' + i + ')');\r\n\t\t}\r\n\t\treturn $('.gvp-row__day').find(selectors.join(', '));\r\n\t}\r\n\t// ---\thour parts\r\n\telse if (el.hasClass('gvp__hour-part')) {\r\n\t\tindex = el.closest('.gvp-row').find('.gvp__hour-part').index(el);\r\n\t\treturn $('.gvp-row__day').find('.gvp__block:eq(' + index + ')');\r\n\t}\r\n\telse{\r\n\t\tconsole.log(el[0].classList, el);\r\n\t}\r\n\treturn $('#void');\r\n};\r\np.ux_colHover = function (e) {\r\n\tthis.ux_unsetHover();\r\n\tthis.ux_colSelect(e).addClass('gvp--target-hover');\r\n};\r\np.ux_colState = function (e) {\r\n\tif (!this._state) {\r\n\t\tthis.ux_error('no-state-selected', 'info');\r\n\t\treturn;\r\n\t}\r\n\tthis.dom_setBlocksState(this.ux_colSelect(e), this._state);\r\n};\r\n\r\np.dom_setBlocksState = function (blocks, state) {\r\n\tif (!blocks || blocks.length === 0) {\r\n\t\tconsole.log('[dom_setBlocksState] no target');\r\n\t\treturn;\r\n\t}\r\n\r\n\tblocks.attr('data-state', state ? state.uid : null);\r\n\r\n\t// render is lock --> skip render\r\n\tif (!this._rangesRenderLock) {\r\n\t\tthis.dom_renderRanges();\r\n\t}\r\n};\r\np.dom_renderRanges = function () {\r\n\tvar self = this,\r\n\t\tstr,\r\n\t\tranges, iRange, iRangeLen, range;\r\n\r\n\t// console.time('dom_renderRanges');\r\n\r\n\t// no drag process running, remove former ranges elements\r\n\tif(this._dragStatus){\r\n\t\tthis._containerEl\r\n\t\t\t.find('.gvp-row__day[data-day-index=\"' + this._dragStatus.y + '\"]')\r\n\t\t\t.find('.gvp__range')\r\n\t\t\t.remove();\r\n\t}\r\n\telse{\r\n\t\tthis._containerEl\r\n\t\t\t.find('.gvp__range')\r\n\t\t\t.remove();\r\n\t}\r\n\r\n\tranges = this.model_retrieveRanges().ranges;\r\n\tfor (iRange = 0, iRangeLen = ranges.length; iRange < iRangeLen; ++iRange) {\r\n\t\trange = ranges[iRange];\r\n\r\n\t\tif(this._dragStatus){\r\n\t\t\tif(range.day !== this._dragStatus.y)\r\n\t\t\t\tcontinue;\r\n\t\t\trange.startBlock.find('.gvp__range').remove();\r\n\t\t}\r\n\r\n\t\t// --- create tooltip instance\r\n\t\tstr = '<div class=\"gvp__range\">';\r\n\t\tstr += '<div class=\"gvp__range-area\"></div>';\r\n\t\tstr += '<div class=\"gvp__range-tooltip\">' + range.start + ' - ' + range.end + '</div>';\r\n\t\tstr += '</div>';\r\n\t\trange.tipEl = $(str);\r\n\r\n\t\trange.tipEl\r\n\t\t\t.css({\r\n\t\t\t\twidth: range.endBlock.offset().left - range.startBlock.offset().left + range.startBlock.width()\r\n\t\t\t})\r\n\t\t\t.appendTo(range.startBlock)\r\n\t\t\t.find('.gvp__range-area')\r\n\t\t\t\t.css({\r\n\t\t\t\t\t'background-color': range.state.color,\r\n\t\t\t\t});\r\n\r\n\t\t(function(range){\r\n\t\t\tfor(var a = range.startIndex; a <= range.endIndex; a++){\r\n\t\t\t\tself._cellsGridArr[range.day][a]\r\n\t\t\t\t\t.on('mouseover', function(){\r\n\t\t\t\t\t\trange.tipEl.addClass('show-tooltip');\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.on('mouseout', function(){\r\n\t\t\t\t\t\trange.tipEl.removeClass('show-tooltip');\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t}(range));\r\n\t}\r\n\r\n\t// console.timeEnd('dom_renderRanges');\r\n};\r\np.dom_build = function () {\r\n\tvar str,\r\n\t\tself = this,\r\n\t\ti, iLen,\r\n\t\tiDay, iDayLen,\r\n\t\tclasses,\r\n\t\tdayCells,\r\n\t\tiHour, iHourMod, iHourLen;\r\n\r\n\r\n\t// ##################### BUILD STATES SELECTORS\r\n\r\n\tstr = '';\r\n\tfor (i = 0, iLen = this._o.states.length; i < iLen; ++i) {\r\n\t\tstr += '<div class=\"gvp-state-selector\" data-state=\"' + this._o.states[i].uid + '\">'\r\n\t\t\t+ '<span class=\"bullet\" style=\"background-color: ' + this._o.states[i].color + ';\"></span>'\r\n\t\t\t+ this._o.states[i].label\r\n\t\t\t+ '</div>';\r\n\t}\r\n\tthis._controlsEl.find('.controls-selectors').append(str);\r\n\r\n\r\n\t// ##################### BUILD GRID\r\n\r\n\tstr = '';\r\n\tiHourLen = 24 * this._o.hourParts;\r\n\r\n\t// ---\thours display\r\n\r\n\tstr += '<div class=\"gvp-row gvp-row__hours\">';\r\n\tstr += '<div></div>';\r\n\tfor (iHour = 0; iHour < iHourLen; iHour++) {\r\n\t\tiHourMod = iHour % this._o.hourParts;\r\n\t\tif (iHourMod === 0) {\r\n\t\t\tstr += '<div class=\"gvp__hour gvp--hour-start';\r\n\t\t\tif(iHour > 0 && (iHour / this._o.hourParts) % 6 == 0){\r\n\t\t\t\tstr += '-xl';\r\n\t\t\t}\r\n\t\t\tstr += '\"><span>' + Math.ceil(iHour / this._o.hourParts) + 'h' + '</span>';\r\n\t\t}\r\n\t\telse if (iHourMod === (this._o.hourParts - 1))\r\n\t\t\tstr += '</div>';\r\n\t}\r\n\tstr += '</div>';\r\n\r\n\r\n\tstr += '<div class=\"gvp-row gvp-row__hour-parts\">';\r\n\tstr += '<div></div>';\r\n\tfor (iHour = 0; iHour < iHourLen; iHour++) {\r\n\t\tstr += '<div class=\"gvp__hour-part';\r\n\t\tif(iHour > 0 && (iHour / this._o.hourParts) % 6 == 0){\r\n\t\t\tstr += ' gvp--hour-start-xl';\r\n\t\t}\r\n\t\tstr += '\"></div>';\r\n\t}\r\n\tstr += '</div>';\r\n\r\n\r\n\t// ---\tdays display\r\n\tfor (iDay = 0, iDayLen = this._o.days.length; iDay < iDayLen; iDay++) {\r\n\t\tstr += '<div class=\"gvp-row gvp-row__day\" data-day-index=\"' + iDay + '\">';\r\n\t\tstr += '<div class=\"gvp__day\">' + this._o.days[iDay] + '</div>';\r\n\t\tfor (iHour = 0; iHour < iHourLen; iHour++) {\r\n\t\t\tclasses = 'gvp__block';\r\n\t\t\tif (iHour % this._o.hourParts === 0) {\r\n\t\t\t\tclasses += (iHour > 0 && ((iHour / this._o.hourParts) % 6 == 0)) ? ' gvp--hour-start-xl' : ' gvp--hour-start';\r\n\t\t\t}\r\n\t\t\tstr += '<div class=\"' + classes + '\"></div>';\r\n\t\t}\r\n\t\tstr += '</div>';\r\n\t}\r\n\r\n\tthis._containerEl.append($(str));\r\n\r\n\r\n\t// --- store all cells\r\n\r\n\tthis._cellsGridArr = [];\r\n\tthis._cellsByDay = [];\r\n\tthis._containerEl.find('.gvp-row__day').each(function (rowIndex, rowEl) {\r\n\t\trowEl = $(rowEl);\r\n\t\tdayCells = [];\r\n\t\trowEl.find('.gvp__block').each(function (blockIndex, blockEl) {\r\n\t\t\tdayCells.push($(blockEl));\r\n\t\t});\r\n\t\tself._cellsGridArr.push(dayCells);\r\n\t\tself._cellsByDay.push(rowEl.find('.gvp__block'));\r\n\t});\r\n\tself._cellsAll = this._containerEl.find('.gvp__block');\r\n};\r\n\r\np.model_getState = function (input) {\r\n\t// retrieve state from event\r\n\tif (typeof input === 'object' && input.hasOwnProperty('target')) {\r\n\t\tinput = $(input.target).attr('data-state');\r\n\t}\r\n\r\n\t// prevent illegal calls\r\n\tif (input === null || typeof input !== 'string') {\r\n\t\tconsole.warn('[GVPlanning.model_setState] Unable to retrieve state from passed-in parameter: ', input);\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfor (var i = 0, iLen = this._o.states.length; i < iLen; ++i) {\r\n\t\tif (this._o.states[i].uid === input) {\r\n\t\t\treturn this._o.states[i];\r\n\t\t}\r\n\t}\r\n\r\n\tconsole.log('[GVPlanning.model_setState] Unable to retrieve state from UID: ', input);\r\n\treturn false;\r\n};\r\np.model_setState = function (state) {\r\n\tstate = this.model_getState(state);\r\n\tif (state === false) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tthis._state = state;\r\n\tthis._controlsEl.find('.gvp-state-selector')\r\n\t\t.removeClass('active')\r\n\t\t.filter('[data-state=\"' + this._state.uid + '\"]').addClass('active');\r\n\tthis._domEl.trigger('stateSelected', {\r\n\t\tstate: this._state\r\n\t});\r\n};\r\np.model_restore = function () {\r\n\tvar\r\n\t\tp = this._o.planning,\r\n\t\tiDay, iDayLen, rowDay,\r\n\t\tiRange, iRangeLen, range, state,\r\n\t\tiCell, iCellLen;\r\n\r\n\tthis._rangesRenderLock = true;\r\n\r\n\t// --- day loop\r\n\tfor (iDay = 0, iDayLen = this._o.days.length; iDay < iDayLen; ++iDay) {\r\n\t\trowDay = this._containerEl.find('.gvp-row__day:eq(' + iDay + ')');\r\n\r\n\t\t// --- range loop\r\n\t\tfor (iRange = 0, iRangeLen = p[iDay].length; iRange < iRangeLen; ++iRange) {\r\n\t\t\trange = p[iDay][iRange];\r\n\t\t\tstate = this.model_getState(range.s);\r\n\r\n\t\t\t// --- cell loop\r\n\t\t\tfor (iCell = this._convertHourToIndex(range.start), iCellLen = this._convertHourToIndex(range.end); iCell < iCellLen; ++iCell) {\r\n\t\t\t\tthis.dom_setBlocksState(rowDay.find('.gvp__block:eq(' + iCell + ')'), state);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tthis._rangesRenderLock = false;\r\n\tthis.dom_renderRanges();\r\n\r\n\tconsole.log('[GVPlanning.model_restore] import completed');\r\n};\r\np.model_export = function () {\r\n\tvar settings = this.model_retrieveRanges();\r\n\tconsole.log('model_export', JSON.stringify(settings.week));\r\n\treturn settings.week;\r\n};\r\np.model_retrieveRanges = function () {\r\n\tvar\r\n\t\tstateUID,\r\n\t\tiDay, iDayLen, row,\r\n\t\tiRange, iRangeLen,\r\n\t\tiBlock, iBlockLen, block,\r\n\t\trowRanges, outRange;\r\n\r\n\t// console.time('model_retrieveRanges');\r\n\r\n\t// --- if a drag process is running remove all ranges belonging to the drag row\r\n\tif(this._dragStatus){\r\n\t\tfor(iRange = this._planning.ranges.length - 1; iRange >= 0; --iRange){\r\n\t\t\tif(this._planning.ranges[iRange].day === this._dragStatus.y){\r\n\t\t\t\tthis._planning.ranges.splice(iRange, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse{\r\n\t\tthis._planning.ranges = [];\r\n\t}\r\n\r\n\tfor (iDay = 0, iDayLen = this._o.days.length; iDay < iDayLen; ++iDay) {\r\n\r\n\t\t// --- if a drag process is running, check only the  drag row\r\n\t\tif(this._dragStatus && this._dragStatus.y !== iDay)\r\n\t\t\tcontinue;\r\n\r\n\t\trow = this._cellsGridArr[iDay];\r\n\t\trowRanges = [];\r\n\t\tfor (iBlock = 0, iBlockLen = row.length; iBlock < iBlockLen; ++iBlock) {\r\n\t\t\tblock = row[iBlock];\r\n\t\t\tif (!outRange) {\r\n\t\t\t\tstateUID = block.attr('data-state') || this._o.stateDefault.uid;\r\n\t\t\t\toutRange = {\r\n\t\t\t\t\ts: stateUID,\r\n\t\t\t\t\tstate: stateUID ? this.model_getState(stateUID) : this._o.stateDefault,\r\n\t\t\t\t\tday: iDay,\r\n\t\t\t\t\tstart: this._convertIndexToHour(iBlock, false),\r\n\t\t\t\t\tstartIndex: iBlock,\r\n\t\t\t\t\tstartBlock: row[iBlock]\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\telse if (block.attr('data-state') !== outRange.s) {\r\n\r\n\t\t\t\tif (outRange.s !== '') {\r\n\t\t\t\t\toutRange.end = this._convertIndexToHour(iBlock, true);\r\n\t\t\t\t\toutRange.endIndex = iBlock - 1;\r\n\t\t\t\t\toutRange.endBlock = row[iBlock - 1];\r\n\t\t\t\t\trowRanges.push(outRange);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstateUID = block.attr('data-state') || this._o.stateDefault.uid;\r\n\t\t\t\toutRange = {\r\n\t\t\t\t\ts: stateUID,\r\n\t\t\t\t\tstate: stateUID ? this.model_getState(stateUID) : this._o.stateDefault,\r\n\t\t\t\t\tday: iDay,\r\n\t\t\t\t\tstart: this._convertIndexToHour(iBlock, false),\r\n\t\t\t\t\tstartIndex: iBlock,\r\n\t\t\t\t\tstartBlock: row[iBlock]\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// if a range is opened --> close and store data\r\n\t\tif (outRange && outRange.s != '') {\r\n\t\t\toutRange.end = this._convertIndexToHour(iBlock, true);\r\n\t\t\toutRange.endIndex = iBlockLen - 1;\r\n\t\t\toutRange.endBlock = row[iBlockLen - 1];\r\n\t\t\trowRanges.push(outRange);\r\n\t\t}\r\n\t\toutRange = null;\r\n\r\n\t\t// copy row ranges\r\n\t\tthis._planning.week[iDay] = [];\r\n\t\tfor (iRange = 0, iRangeLen = rowRanges.length; iRange < iRangeLen; ++iRange) {\r\n\t\t\tthis._planning.ranges.push(rowRanges[iRange]);\r\n\t\t\tthis._planning.week[iDay].push({\r\n\t\t\t\ts: rowRanges[iRange].s,\r\n\t\t\t\tstart: rowRanges[iRange].start,\r\n\t\t\t\tend: rowRanges[iRange].end\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t// console.timeEnd('model_retrieveRanges');\r\n\treturn this._planning;\r\n};\r\n\r\n\r\np._convertHourToIndex = function (s) {\r\n\tvar tokens = s.split(':'),\r\n\t\th = parseInt(tokens[0]),\r\n\t\tm = parseInt(tokens[1]);\r\n\tif (m % (60 / this._o.hourParts) !== 0)\r\n\t\tm += 1;\r\n\treturn (h * this._o.hourParts) + (m / (60 / this._o.hourParts));\r\n};\r\np._convertIndexToHour = function (i, offset) {\r\n\tvar h, m;\r\n\th = Math.floor(i / this._o.hourParts);\r\n\tm = 60 / this._o.hourParts * (i % this._o.hourParts);\r\n\tif (offset === true) {\r\n\t\tm = (m - 1 + 60) % 60;\r\n\t\tif (m === 59)\r\n\t\t\th -= 1;\r\n\t}\r\n\th = (h + 24) % 24;\r\n\r\n\th = h.toString();\r\n\tm = m.toString();\r\n\treturn ((h.length < 2) ? '0' + h : h) + ':' + ((m.length < 2) ? '0' + m : m);\r\n};"]}