{"version":3,"sources":["bundle.js"],"names":["GVPlanning","selector","options","this","_o","Object","assign","feedbackCallback","hourFrom","hourTo","hourParts","days","states","stateDefault","stateSelectedDefault","model_getState","_cbs","model_setState","bind","ux_unsetHover","ux_colState","ux_colHover","ux_rowState","ux_rowHover","ux_blockState","ux_blockStateWatch","_state","_rangesRenderLock","_dragStartCell","_planning","ranges","week","_domEl","$","addClass","_containerEl","find","_controlsEl","dom_build","ux_interactions","planning","model_restore","p","prototype","on","ux_error","message","level","console","log","e","button","type","document","window","off","block","row","xBlock","yBlock","selBlocks","target","parent","index","parseInt","attr","y","x","_cellsByDay","slice","Math","min","max","dom_setBlocksState","_cellsAll","removeClass","ux_rowSelect","closest","ux_colSelect","selectors","el","is","i","iLen","push","join","blocks","state","length","uid","dom_renderRanges","str","iRange","iRangeLen","range","self","remove","model_retrieveRanges","day","startBlock","start","end","tipEl","css","width","endBlock","offset","left","appendTo","background-color","color","a","startIndex","endIndex","_cellsGridArr","iDay","iDayLen","classes","dayCells","iHour","iHourMod","iHourLen","label","append","ceil","each","rowIndex","rowEl","blockIndex","blockEl","input","hasOwnProperty","warn","filter","trigger","rowDay","iCell","iCellLen","s","_convertHourToIndex","model_export","settings","JSON","stringify","stateUID","iBlock","iBlockLen","rowRanges","outRange","splice","_convertIndexToHour","tokens","split","h","m","floor","toString"],"mappings":"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","file":"../bundle.js","sourcesContent":["var GVPlanning = function (selector, options) {\r\n\r\n\t// ##########################################\r\n\r\n\t// --- options\r\n\r\n\tthis._o = Object.assign({\r\n\t\tfeedbackCallback: null,\r\n\t\thourFrom: 0,\r\n\t\thourTo: 24,\r\n\t\thourParts: 4,\r\n\t\tdays: [],\r\n\t\tstates: [],\r\n\t\tstateDefault: null,\r\n\t\tstateSelectedDefault: null,\r\n\t}, options);\r\n\r\n\tif(!this._o.stateDefault)\r\n\t\tthis._o.stateDefault = this._o.states[0];\r\n\telse if(typeof this._o.stateDefault === 'string')\r\n\t\tthis._o.stateDefault = this.model_getState(this._o.stateDefault);\r\n\r\n\r\n\t// --- variables initialization\r\n\r\n\tthis._cbs = {\r\n\t\tmodel_setState: this.model_setState.bind(this),\r\n\t\tux_unsetHover: this.ux_unsetHover.bind(this),\r\n\t\tux_colState: this.ux_colState.bind(this),\r\n\t\tux_colHover: this.ux_colHover.bind(this),\r\n\t\tux_rowState: this.ux_rowState.bind(this),\r\n\t\tux_rowHover: this.ux_rowHover.bind(this),\r\n\t\tux_blockState: this.ux_blockState.bind(this),\r\n\t\tux_blockStateWatch: this.ux_blockStateWatch.bind(this),\r\n\t};\r\n\r\n\tthis._state = null;\r\n\r\n\t// allow developper to lock rendering during extensive update processes\r\n\tthis._rangesRenderLock = false;\r\n\t// while dragging to \"paint\" in block-type cells, store the position of the drag start position\r\n\tthis._dragStartCell = null;\r\n\t// store all ranges settings\r\n\tthis._planning = {\r\n\t\tranges: [],\r\n\t\tweek: [],\r\n\t};\r\n\t\r\n\t// ########################################## INIT INSTANCE\r\n\r\n\tthis._domEl = $(selector)\r\n\t\t.addClass('gvp');\r\n\tthis._containerEl = this._domEl.find('.gvp-container');\r\n\tthis._controlsEl = this._domEl.find('.gvp-controls');\r\n\r\n\tthis.dom_build();\r\n\r\n\tthis.ux_interactions();\r\n\r\n\r\n\t// --- if a configuration is set ==> display it\r\n\tif (this._o.planning) {\r\n\t\tthis.model_restore();\r\n\t}\r\n\tif (this._o.stateSelectedDefault) {\r\n\t\tthis.model_setState(this._o.stateSelectedDefault);\r\n\t}\r\n};\r\nvar p = GVPlanning.prototype;\r\n\r\n\r\np.ux_interactions = function () {\r\n\tthis._containerEl\r\n\r\n\t// --- complete day\r\n\t\t.on('click', '.gvp__day', this._cbs.ux_rowState)\r\n\t\t.on('mouseover', '.gvp__day', this._cbs.ux_rowHover)\r\n\t\t.on('mouseleave', '.gvp__day', this._cbs.ux_unsetHover)\r\n\r\n\t\t// ---\tcomplete hour\r\n\t\t.on('click', '.gvp__hour', this._cbs.ux_colState)\r\n\t\t.on('mouseover', '.gvp__hour', this._cbs.ux_colHover)\r\n\t\t.on('mouseleave', '.gvp__hour', this._cbs.ux_unsetHover)\r\n\r\n\t\t// ---\thour part\r\n\t\t.on('click', '.gvp__hour-part', this._cbs.ux_colState)\r\n\t\t.on('mouseover', '.gvp__hour-part', this._cbs.ux_colHover)\r\n\t\t.on('mouseleave', '.gvp__hour-part', this._cbs.ux_unsetHover)\r\n\r\n\t\t// --- element\r\n\t\t.on('mousedown', '.gvp__block', this._cbs.ux_blockStateWatch)\r\n\t;\r\n\r\n\tthis._controlsEl\r\n\t\t.on('click', '.gvp-state-selector', this._cbs.model_setState)\r\n\t;\r\n};\r\np.ux_error = function (message, level) {\r\n\tif(this._o.feedbackCallback){\r\n\t\tthis._o.feedbackCallback(message, level);\r\n\t}\r\n\tconsole.log('[' + level + ']', message);\r\n};\r\np.ux_blockStateWatch = function (e) {\r\n\tif (!this._state) {\r\n\t\tthis.ux_error('no-state-selected');\r\n\t\treturn;\r\n\t}\r\n\tif (e.button && e.button === 2) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (e.type === 'mousedown') {\r\n\t\tthis._containerEl\r\n\t\t\t.on('mouseover', '.gvp__block', this._cbs.ux_blockState);\r\n\t\t$(document)\r\n\t\t\t.on('mouseup', this._cbs.ux_blockStateWatch);\r\n\t\t$(window)\r\n\t\t\t.on('mouseup', this._cbs.ux_blockStateWatch);\r\n\r\n\t\tthis.ux_blockState(e);\r\n\t}\r\n\telse{\r\n\t\t// release drag lock\r\n\t\tthis._dragStartCell = null;\r\n\r\n\t\tthis._containerEl\r\n\t\t\t.off('mouseover', '.gvp__block', this._cbs.ux_blockState);\r\n\t\t$(document)\r\n\t\t\t.off('mouseup', this._cbs.ux_blockStateWatch);\r\n\t\t$(window)\r\n\t\t\t.off('mouseup', this._cbs.ux_blockStateWatch);\r\n\t}\r\n};\r\np.ux_blockState = function (e) {\r\n\tvar block, row, xBlock, yBlock, selBlocks;\r\n\r\n\tif (!this._state) {\r\n\t\tthis.ux_error('no-state-selected');\r\n\t\treturn;\r\n\t}\r\n\r\n\tblock = $(e.target);\r\n\trow = block.parent('.gvp-row__day');\r\n\txBlock = row.find('.gvp__block').index(block);\r\n\tyBlock = parseInt(row.attr('data-day-index'));\r\n\r\n\tif(!this._dragStartCell){\r\n\t\tthis._dragStartCell = {\r\n\t\t\tx: xBlock,\r\n\t\t\ty: yBlock\r\n\t\t};\r\n\t}\r\n\telse if(yBlock != this._dragStartCell.y){\r\n\t\treturn;\r\n\t}\r\n\r\n\tselBlocks = this._cellsByDay[yBlock].slice(\r\n\t\tMath.min(xBlock, this._dragStartCell.x),\r\n\t\tMath.max(xBlock, this._dragStartCell.x)\r\n\t);\r\n\tthis.dom_setBlocksState(selBlocks, this._state);\r\n};\r\np.ux_unsetHover = function () {\r\n\tthis._cellsAll.removeClass('gvp--target-hover');\r\n};\r\np.ux_rowSelect = function (e) {\r\n\treturn $(e.target).closest('.gvp-row').find('.gvp__block');\r\n};\r\np.ux_rowHover = function (e) {\r\n\tthis.ux_unsetHover();\r\n\tthis.ux_rowSelect(e).addClass('gvp--target-hover');\r\n};\r\np.ux_rowState = function (e) {\r\n\tif (!this._state) {\r\n\t\tthis.ux_error('no-state-selected');\r\n\t\treturn;\r\n\t}\r\n\tthis.dom_setBlocksState(this.ux_rowSelect(e), this._state);\r\n};\r\np.ux_colSelect = function (e) {\r\n\tvar el = $(e.target), index, selectors;\r\n\r\n\t// ---\tcomplete hour\r\n\tif (el.is('.gvp__hour')) {\r\n\t\tindex = el.closest('.gvp-row').find('.gvp__hour').index(el);\r\n\t\tselectors = [];\r\n\t\tfor (var i = index * this._o.hourParts, iLen = i + this._o.hourParts; i < iLen; ++i) {\r\n\t\t\tselectors.push('.gvp__block:eq(' + i + ')');\r\n\t\t}\r\n\t\treturn $('.gvp-row__day').find(selectors.join(', '));\r\n\t}\r\n\t// ---\thour parts\r\n\telse if (el.is('.gvp__hour-part')) {\r\n\t\tindex = el.closest('.gvp-row').find('.gvp__hour-part').index(el);\r\n\t\treturn $('.gvp-row__day').find('.gvp__block:eq(' + index + ')');\r\n\r\n\t}\r\n};\r\np.ux_colHover = function (e) {\r\n\tthis.ux_unsetHover();\r\n\tthis.ux_colSelect(e).addClass('gvp--target-hover');\r\n};\r\np.ux_colState = function (e) {\r\n\tif (!this._state) {\r\n\t\tthis.ux_error('no-state-selected');\r\n\t\treturn;\r\n\t}\r\n\tthis.dom_setBlocksState(this.ux_colSelect(e), this._state);\r\n};\r\n\r\n\r\np.dom_setBlocksState = function (blocks, state) {\r\n\tif (!blocks || blocks.length === 0) {\r\n\t\tthis.ux_error('no-target');\r\n\t\treturn;\r\n\t}\r\n\r\n\tblocks.attr('data-state', state ? state.uid : null);\r\n\r\n\t// render is lock --> skip render\r\n\tif (!this._rangesRenderLock) {\r\n\t\tthis.dom_renderRanges();\r\n\t}\r\n};\r\np.dom_renderRanges = function () {\r\n\tvar self = this,\r\n\t\tstr,\r\n\t\tranges, iRange, iRangeLen, range;\r\n\r\n\t// console.time('dom_renderRanges');\r\n\r\n\t// no drag process running, remove former ranges elements\r\n\tif(this._dragStartCell){\r\n\t\tthis._containerEl\r\n\t\t\t.find('.gvp-row__day[data-day-index=\"' + this._dragStartCell.y + '\"]')\r\n\t\t\t.find('.gvp__range')\r\n\t\t\t.remove();\r\n\t}\r\n\telse{\r\n\t\tthis._containerEl\r\n\t\t\t.find('.gvp__range')\r\n\t\t\t.remove();\r\n\t}\r\n\r\n\tranges = this.model_retrieveRanges().ranges;\r\n\tfor (iRange = 0, iRangeLen = ranges.length; iRange < iRangeLen; ++iRange) {\r\n\t\trange = ranges[iRange];\r\n\r\n\t\tif(this._dragStartCell){\r\n\t\t\tif(range.day !== this._dragStartCell.y)\r\n\t\t\t\tcontinue;\r\n\t\t\trange.startBlock.find('.gvp__range').remove();\r\n\t\t}\r\n\r\n\t\t// --- create tooltip instance\r\n\t\tstr = '<div class=\"gvp__range\">';\r\n\t\tstr += '<div class=\"gvp__range-area\"></div>';\r\n\t\tstr += '<div class=\"gvp__range-tooltip\">' + range.start + ' - ' + range.end + '</div>';\r\n\t\tstr += '</div>';\r\n\t\trange.tipEl = $(str);\r\n\r\n\t\trange.tipEl\r\n\t\t\t.css({\r\n\t\t\t\twidth: range.endBlock.offset().left - range.startBlock.offset().left + range.startBlock.width()\r\n\t\t\t})\r\n\t\t\t.appendTo(range.startBlock)\r\n\t\t\t.find('.gvp__range-area')\r\n\t\t\t\t.css({\r\n\t\t\t\t\t'background-color': range.state.color,\r\n\t\t\t\t});\r\n\r\n\t\t(function(range){\r\n\t\t\tfor(var a = range.startIndex; a <= range.endIndex; a++){\r\n\t\t\t\tself._cellsGridArr[range.day][a]\r\n\t\t\t\t\t.on('mouseover', function(){\r\n\t\t\t\t\t\trange.tipEl.addClass('show-tooltip');\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.on('mouseout', function(){\r\n\t\t\t\t\t\trange.tipEl.removeClass('show-tooltip');\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t}(range));\r\n\t}\r\n\r\n\t// console.timeEnd('dom_renderRanges');\r\n};\r\np.dom_build = function () {\r\n\tvar str,\r\n\t\tself = this,\r\n\t\ti, iLen,\r\n\t\tiDay, iDayLen,\r\n\t\tclasses,\r\n\t\tdayCells,\r\n\t\tiHour, iHourMod, iHourLen;\r\n\r\n\r\n\t// ##################### BUILD STATES SELECTORS\r\n\r\n\tstr = '';\r\n\tfor (i = 0, iLen = this._o.states.length; i < iLen; ++i) {\r\n\t\tstr += '<div class=\"gvp-state-selector\" data-state=\"' + this._o.states[i].uid + '\">'\r\n\t\t\t+ '<span class=\"bullet\" style=\"background-color: ' + this._o.states[i].color + ';\"></span>'\r\n\t\t\t+ this._o.states[i].label\r\n\t\t\t+ '</div>';\r\n\t}\r\n\tthis._controlsEl.find('.controls-selectors').append(str);\r\n\r\n\r\n\t// ##################### BUILD GRID\r\n\r\n\tstr = '';\r\n\tiHourLen = 24 * this._o.hourParts;\r\n\r\n\t// ---\thours display\r\n\r\n\tstr += '<div class=\"gvp-row gvp-row__hours\">';\r\n\tstr += '<div></div>';\r\n\tfor (iHour = 0; iHour < iHourLen; iHour++) {\r\n\t\tiHourMod = iHour % this._o.hourParts;\r\n\t\tif (iHourMod === 0) {\r\n\t\t\tstr += '<div class=\"gvp__hour gvp--hour-start';\r\n\t\t\tif(iHour > 0 && (iHour / this._o.hourParts) % 6 == 0){\r\n\t\t\t\tstr += '-xl';\r\n\t\t\t}\r\n\t\t\tstr += '\">' + Math.ceil(iHour / this._o.hourParts) + 'h';\r\n\t\t}\r\n\t\telse if (iHourMod === (this._o.hourParts - 1))\r\n\t\t\tstr += '</div>';\r\n\t}\r\n\tstr += '</div>';\r\n\r\n\r\n\tstr += '<div class=\"gvp-row gvp-row__hour-parts\">';\r\n\tstr += '<div></div>';\r\n\tfor (iHour = 0; iHour < iHourLen; iHour++) {\r\n\t\tstr += '<div class=\"gvp__hour-part';\r\n\t\tif(iHour > 0 && (iHour / this._o.hourParts) % 6 == 0){\r\n\t\t\tstr += ' gvp--hour-start-xl';\r\n\t\t}\r\n\t\tstr += '\"></div>';\r\n\t}\r\n\tstr += '</div>';\r\n\r\n\r\n\t// ---\tdays display\r\n\tfor (iDay = 0, iDayLen = this._o.days.length; iDay < iDayLen; iDay++) {\r\n\t\tstr += '<div class=\"gvp-row gvp-row__day\" data-day-index=\"' + iDay + '\">';\r\n\t\tstr += '<div class=\"gvp__day\">' + this._o.days[iDay] + '</div>';\r\n\t\tfor (iHour = 0; iHour < iHourLen; iHour++) {\r\n\t\t\tclasses = 'gvp__block';\r\n\t\t\tif (iHour % this._o.hourParts === 0) {\r\n\t\t\t\tclasses += (iHour > 0 && ((iHour / this._o.hourParts) % 6 == 0)) ? ' gvp--hour-start-xl' : ' gvp--hour-start';\r\n\t\t\t}\r\n\t\t\tstr += '<div class=\"' + classes + '\"></div>';\r\n\t\t}\r\n\t\tstr += '</div>';\r\n\t}\r\n\r\n\tthis._containerEl.append($(str));\r\n\r\n\r\n\t// --- store all cells\r\n\r\n\tthis._cellsGridArr = [];\r\n\tthis._cellsByDay = [];\r\n\tthis._containerEl.find('.gvp-row__day').each(function (rowIndex, rowEl) {\r\n\t\trowEl = $(rowEl);\r\n\t\tdayCells = [];\r\n\t\trowEl.find('.gvp__block').each(function (blockIndex, blockEl) {\r\n\t\t\tdayCells.push($(blockEl));\r\n\t\t});\r\n\t\tself._cellsGridArr.push(dayCells);\r\n\t\tself._cellsByDay.push(rowEl.find('.gvp__block'));\r\n\t});\r\n\tself._cellsAll = this._containerEl.find('.gvp__block');\r\n};\r\n\r\n\r\np.model_getState = function (input) {\r\n\t// retrieve state from event\r\n\tif (typeof input === 'object' && input.hasOwnProperty('target')) {\r\n\t\tinput = $(input.target).attr('data-state');\r\n\t}\r\n\r\n\t// prevent illegal calls\r\n\tif (input === null || typeof input !== 'string') {\r\n\t\tconsole.warn('[GVPlanning.model_setState] Unable to retrieve state from passed-in parameter: ', input);\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfor (var i = 0, iLen = this._o.states.length; i < iLen; ++i) {\r\n\t\tif (this._o.states[i].uid === input) {\r\n\t\t\treturn this._o.states[i];\r\n\t\t}\r\n\t}\r\n\r\n\tconsole.log('[GVPlanning.model_setState] Unable to retrieve state from UID: ', input);\r\n\treturn false;\r\n};\r\np.model_setState = function (state) {\r\n\tstate = this.model_getState(state);\r\n\tif (state === false) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tthis._state = state;\r\n\tthis._controlsEl.find('.gvp-state-selector')\r\n\t\t.removeClass('active')\r\n\t\t.filter('[data-state=\"' + this._state.uid + '\"]').addClass('active');\r\n\tthis._domEl.trigger('stateSelected', {\r\n\t\tstate: this._state\r\n\t});\r\n};\r\np.model_restore = function () {\r\n\tvar\r\n\t\tp = this._o.planning,\r\n\t\tiDay, iDayLen, rowDay,\r\n\t\tiRange, iRangeLen, range, state,\r\n\t\tiCell, iCellLen;\r\n\r\n\tthis._rangesRenderLock = true;\r\n\r\n\t// --- day loop\r\n\tfor (iDay = 0, iDayLen = this._o.days.length; iDay < iDayLen; ++iDay) {\r\n\t\trowDay = this._containerEl.find('.gvp-row__day:eq(' + iDay + ')');\r\n\r\n\t\t// --- range loop\r\n\t\tfor (iRange = 0, iRangeLen = p[iDay].length; iRange < iRangeLen; ++iRange) {\r\n\t\t\trange = p[iDay][iRange];\r\n\t\t\tstate = this.model_getState(range.s);\r\n\r\n\t\t\t// --- cell loop\r\n\t\t\tfor (iCell = this._convertHourToIndex(range.start), iCellLen = this._convertHourToIndex(range.end); iCell < iCellLen; ++iCell) {\r\n\t\t\t\tthis.dom_setBlocksState(rowDay.find('.gvp__block:eq(' + iCell + ')'), state);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tthis._rangesRenderLock = false;\r\n\tthis.dom_renderRanges();\r\n\r\n\tconsole.log('[GVPlanning.model_restore] import completed');\r\n};\r\np.model_export = function () {\r\n\tvar settings = this.model_retrieveRanges();\r\n\tconsole.log('model_export', JSON.stringify(settings.week));\r\n\treturn settings.week;\r\n};\r\np.model_retrieveRanges = function () {\r\n\tvar\r\n\t\tstateUID,\r\n\t\tiDay, iDayLen, row,\r\n\t\tiRange, iRangeLen,\r\n\t\tiBlock, iBlockLen, block,\r\n\t\trowRanges, outRange;\r\n\r\n\t// console.time('model_retrieveRanges');\r\n\r\n\t// --- if a drag process is running remove all ranges belonging to the drag row\r\n\tif(this._dragStartCell){\r\n\t\tfor(iRange = this._planning.ranges.length - 1; iRange >= 0; --iRange){\r\n\t\t\tif(this._planning.ranges[iRange].day === this._dragStartCell.y){\r\n\t\t\t\tthis._planning.ranges.splice(iRange, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse{\r\n\t\tthis._planning.ranges = [];\r\n\t}\r\n\r\n\tfor (iDay = 0, iDayLen = this._o.days.length; iDay < iDayLen; ++iDay) {\r\n\r\n\t\t// --- if a drag process is running, check only the  drag row\r\n\t\tif(this._dragStartCell && this._dragStartCell.y !== iDay)\r\n\t\t\tcontinue;\r\n\r\n\t\trow = this._cellsGridArr[iDay];\r\n\t\trowRanges = [];\r\n\t\tfor (iBlock = 0, iBlockLen = row.length; iBlock < iBlockLen; ++iBlock) {\r\n\t\t\tblock = row[iBlock];\r\n\t\t\tif (!outRange) {\r\n\t\t\t\tstateUID = block.attr('data-state') || this._o.stateDefault.uid;\r\n\t\t\t\toutRange = {\r\n\t\t\t\t\ts: stateUID,\r\n\t\t\t\t\tstate: stateUID ? this.model_getState(stateUID) : this._o.stateDefault,\r\n\t\t\t\t\tday: iDay,\r\n\t\t\t\t\tstart: this._convertIndexToHour(iBlock, false),\r\n\t\t\t\t\tstartIndex: iBlock,\r\n\t\t\t\t\tstartBlock: row[iBlock]\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\telse if (block.attr('data-state') !== outRange.s) {\r\n\r\n\t\t\t\tif (outRange.s !== '') {\r\n\t\t\t\t\toutRange.end = this._convertIndexToHour(iBlock, true);\r\n\t\t\t\t\toutRange.endIndex = iBlock - 1;\r\n\t\t\t\t\toutRange.endBlock = row[iBlock - 1];\r\n\t\t\t\t\trowRanges.push(outRange);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstateUID = block.attr('data-state') || this._o.stateDefault.uid;\r\n\t\t\t\toutRange = {\r\n\t\t\t\t\ts: stateUID,\r\n\t\t\t\t\tstate: stateUID ? this.model_getState(stateUID) : this._o.stateDefault,\r\n\t\t\t\t\tday: iDay,\r\n\t\t\t\t\tstart: this._convertIndexToHour(iBlock, false),\r\n\t\t\t\t\tstartIndex: iBlock,\r\n\t\t\t\t\tstartBlock: row[iBlock]\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// if a range is opened --> close and store data\r\n\t\tif (outRange && outRange.s != '') {\r\n\t\t\toutRange.end = this._convertIndexToHour(iBlock, true);\r\n\t\t\toutRange.endIndex = iBlockLen - 1;\r\n\t\t\toutRange.endBlock = row[iBlockLen - 1];\r\n\t\t\trowRanges.push(outRange);\r\n\t\t}\r\n\t\toutRange = null;\r\n\r\n\t\t// copy row ranges\r\n\t\tthis._planning.week[iDay] = [];\r\n\t\tfor (iRange = 0, iRangeLen = rowRanges.length; iRange < iRangeLen; ++iRange) {\r\n\t\t\tthis._planning.ranges.push(rowRanges[iRange]);\r\n\t\t\tthis._planning.week[iDay].push({\r\n\t\t\t\ts: rowRanges[iRange].s,\r\n\t\t\t\tstart: rowRanges[iRange].start,\r\n\t\t\t\tend: rowRanges[iRange].end\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t// console.timeEnd('model_retrieveRanges');\r\n\treturn this._planning;\r\n};\r\n\r\n\r\np._convertHourToIndex = function (s) {\r\n\tvar tokens = s.split(':'),\r\n\t\th = parseInt(tokens[0]),\r\n\t\tm = parseInt(tokens[1]);\r\n\tif (m % (60 / this._o.hourParts) !== 0)\r\n\t\tm += 1;\r\n\treturn (h * this._o.hourParts) + (m / (60 / this._o.hourParts));\r\n};\r\np._convertIndexToHour = function (i, offset) {\r\n\tvar h, m;\r\n\th = Math.floor(i / this._o.hourParts);\r\n\tm = 60 / this._o.hourParts * (i % this._o.hourParts);\r\n\tif (offset === true) {\r\n\t\tm = (m - 1 + 60) % 60;\r\n\t\tif (m === 59)\r\n\t\t\th -= 1;\r\n\t}\r\n\th = (h + 24) % 24;\r\n\r\n\th = h.toString();\r\n\tm = m.toString();\r\n\treturn ((h.length < 2) ? '0' + h : h) + ':' + ((m.length < 2) ? '0' + m : m);\r\n};"]}