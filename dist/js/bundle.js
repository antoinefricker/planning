var GVPlanning=function(t,e){this._o=Object.assign({feedbackCallback:null,hourFrom:0,hourTo:24,hourParts:4,days:[],states:[],stateDefault:null,stateSelectedDefault:null},e),this._o.stateDefault?"string"==typeof this._o.stateDefault&&(this._o.stateDefault=this.model_getState(this._o.stateDefault)):this._o.stateDefault=this._o.states[0],this._cbs={model_setState:this.model_setState.bind(this),ux_unsetHover:this.ux_unsetHover.bind(this),ux_colState:this.ux_colState.bind(this),ux_colHover:this.ux_colHover.bind(this),ux_rowState:this.ux_rowState.bind(this),ux_rowHover:this.ux_rowHover.bind(this),ux_blockState:this.ux_blockState.bind(this),ux_blockStateWatch:this.ux_blockStateWatch.bind(this)},this._state=null,this._rangesRenderLock=!1,this._dragStartCell=null,this._planning={ranges:[],week:[]},this._domEl=$(t).addClass("gvp"),this._containerEl=this._domEl.find(".gvp-container"),this._controlsEl=this._domEl.find(".gvp-controls"),this.dom_build(),this.ux_interactions(),this._o.planning&&this.model_restore(),this._o.stateSelectedDefault&&this.model_setState(this._o.stateSelectedDefault)},p=GVPlanning.prototype;p.ux_interactions=function(){this._containerEl.on("click",".gvp__day",this._cbs.ux_rowState).on("mouseover",".gvp__day",this._cbs.ux_rowHover).on("mouseleave",".gvp__day",this._cbs.ux_unsetHover).on("click",".gvp__hour",this._cbs.ux_colState).on("mouseover",".gvp__hour",this._cbs.ux_colHover).on("mouseleave",".gvp__hour",this._cbs.ux_unsetHover).on("click",".gvp__hour-part",this._cbs.ux_colState).on("mouseover",".gvp__hour-part",this._cbs.ux_colHover).on("mouseleave",".gvp__hour-part",this._cbs.ux_unsetHover).on("mousedown",".gvp__block",this._cbs.ux_blockStateWatch),this._controlsEl.on("click",".gvp-state-selector",this._cbs.model_setState)},p.ux_error=function(t,e){this._o.feedbackCallback&&this._o.feedbackCallback(t,e),console.log("["+e+"]",t)},p.ux_blockStateWatch=function(t){this._state?t.button&&2===t.button||("mousedown"===t.type?(this._containerEl.on("mouseover",".gvp__block",this._cbs.ux_blockState),$(document).on("mouseup",this._cbs.ux_blockStateWatch),$(window).on("mouseup",this._cbs.ux_blockStateWatch),this.ux_blockState(t)):(this._dragStartCell=null,this._containerEl.off("mouseover",".gvp__block",this._cbs.ux_blockState),$(document).off("mouseup",this._cbs.ux_blockStateWatch),$(window).off("mouseup",this._cbs.ux_blockStateWatch))):this.ux_error("no-state-selected")},p.ux_blockState=function(t){var e,s,o,a,r;if(this._state){if(o=(s=(e=$(t.target)).parent(".gvp-row__day")).find(".gvp__block").index(e),a=parseInt(s.attr("data-day-index")),this._dragStartCell){if(a!=this._dragStartCell.y)return}else this._dragStartCell={x:o,y:a};r=this._cellsByDay[a].slice(Math.min(o,this._dragStartCell.x),Math.max(o,this._dragStartCell.x)),this.dom_setBlocksState(r,this._state)}else this.ux_error("no-state-selected")},p.ux_unsetHover=function(){this._cellsAll.removeClass("gvp--target-hover")},p.ux_rowSelect=function(t){return $(t.target).closest(".gvp-row").find(".gvp__block")},p.ux_rowHover=function(t){this.ux_unsetHover(),this.ux_rowSelect(t).addClass("gvp--target-hover")},p.ux_rowState=function(t){this._state?this.dom_setBlocksState(this.ux_rowSelect(t),this._state):this.ux_error("no-state-selected")},p.ux_colSelect=function(t){var e,s,o=$(t.target);if(o.is(".gvp__hour")){s=[];for(var a=(e=o.closest(".gvp-row").find(".gvp__hour").index(o))*this._o.hourParts,r=a+this._o.hourParts;a<r;++a)s.push(".gvp__block:eq("+a+")");return $(".gvp-row__day").find(s.join(", "))}if(o.is(".gvp__hour-part"))return e=o.closest(".gvp-row").find(".gvp__hour-part").index(o),$(".gvp-row__day").find(".gvp__block:eq("+e+")")},p.ux_colHover=function(t){this.ux_unsetHover(),this.ux_colSelect(t).addClass("gvp--target-hover")},p.ux_colState=function(t){this._state?this.dom_setBlocksState(this.ux_colSelect(t),this._state):this.ux_error("no-state-selected")},p.dom_setBlocksState=function(t,e){t&&0!==t.length?(t.attr("data-state",e?e.uid:null),this._rangesRenderLock||this.dom_renderRanges()):this.ux_error("no-target")},p.dom_renderRanges=function(){var t,e,s,o,a,r=this;for(this._dragStartCell?this._containerEl.find('.gvp-row__day[data-day-index="'+this._dragStartCell.y+'"]').find(".gvp__range").remove():this._containerEl.find(".gvp__range").remove(),s=0,o=(e=this.model_retrieveRanges().ranges).length;s<o;++s){if(a=e[s],this._dragStartCell){if(a.day!==this._dragStartCell.y)continue;a.startBlock.find(".gvp__range").remove()}t='<div class="gvp__range">',t+='<div class="gvp__range-area"></div>',t+='<div class="gvp__range-tooltip">'+a.start+" - "+a.end+"</div>",t+="</div>",a.tipEl=$(t),a.tipEl.css({width:a.endBlock.offset().left-a.startBlock.offset().left+a.startBlock.width()}).appendTo(a.startBlock).find(".gvp__range-area").css({"background-color":a.state.color}),function(t){for(var e=t.startIndex;e<=t.endIndex;e++)r._cellsGridArr[t.day][e].on("mouseover",function(){t.tipEl.addClass("show-tooltip")}).on("mouseout",function(){t.tipEl.removeClass("show-tooltip")})}(a)}},p.dom_build=function(){var t,e,s,o,a,r,i,n,_,l,h=this;for(t="",e=0,s=this._o.states.length;e<s;++e)t+='<div class="gvp-state-selector" data-state="'+this._o.states[e].uid+'"><span class="bullet" style="background-color: '+this._o.states[e].color+';"></span>'+this._o.states[e].label+"</div>";for(this._controlsEl.find(".controls-selectors").append(t),t="",l=24*this._o.hourParts,t+='<div class="gvp-row gvp-row__hours">',t+="<div></div>",n=0;n<l;n++)0===(_=n%this._o.hourParts)?(t+='<div class="gvp__hour gvp--hour-start',0<n&&n/this._o.hourParts%6==0&&(t+="-xl"),t+='">'+Math.ceil(n/this._o.hourParts)+"h"):_===this._o.hourParts-1&&(t+="</div>");for(t+="</div>",t+='<div class="gvp-row gvp-row__hour-parts">',t+="<div></div>",n=0;n<l;n++)t+='<div class="gvp__hour-part',0<n&&n/this._o.hourParts%6==0&&(t+=" gvp--hour-start-xl"),t+='"></div>';for(t+="</div>",o=0,a=this._o.days.length;o<a;o++){for(t+='<div class="gvp-row gvp-row__day" data-day-index="'+o+'">',t+='<div class="gvp__day">'+this._o.days[o]+"</div>",n=0;n<l;n++)r="gvp__block",n%this._o.hourParts==0&&(r+=0<n&&n/this._o.hourParts%6==0?" gvp--hour-start-xl":" gvp--hour-start"),t+='<div class="'+r+'"></div>';t+="</div>"}this._containerEl.append($(t)),this._cellsGridArr=[],this._cellsByDay=[],this._containerEl.find(".gvp-row__day").each(function(t,e){e=$(e),i=[],e.find(".gvp__block").each(function(t,e){i.push($(e))}),h._cellsGridArr.push(i),h._cellsByDay.push(e.find(".gvp__block"))}),h._cellsAll=this._containerEl.find(".gvp__block")},p.model_getState=function(t){if("object"==typeof t&&t.hasOwnProperty("target")&&(t=$(t.target).attr("data-state")),null===t||"string"!=typeof t)return console.warn("[GVPlanning.model_setState] Unable to retrieve state from passed-in parameter: ",t),!1;for(var e=0,s=this._o.states.length;e<s;++e)if(this._o.states[e].uid===t)return this._o.states[e];return console.log("[GVPlanning.model_setState] Unable to retrieve state from UID: ",t),!1},p.model_setState=function(t){!1!==(t=this.model_getState(t))&&(this._state=t,this._controlsEl.find(".gvp-state-selector").removeClass("active").filter('[data-state="'+this._state.uid+'"]').addClass("active"),this._domEl.trigger("stateSelected",{state:this._state}))},p.model_restore=function(){var t,e,s,o,a,r,i,n,_,l=this._o.planning;for(this._rangesRenderLock=!0,t=0,e=this._o.days.length;t<e;++t)for(s=this._containerEl.find(".gvp-row__day:eq("+t+")"),o=0,a=l[t].length;o<a;++o)for(r=l[t][o],i=this.model_getState(r.s),n=this._convertHourToIndex(r.start),_=this._convertHourToIndex(r.end);n<_;++n)this.dom_setBlocksState(s.find(".gvp__block:eq("+n+")"),i);this._rangesRenderLock=!1,this.dom_renderRanges(),console.log("[GVPlanning.model_restore] import completed")},p.model_export=function(){var t=this.model_retrieveRanges();return console.log("model_export",JSON.stringify(t.week)),t.week},p.model_retrieveRanges=function(){var t,e,s,o,a,r,i,n,_,l,h;if(this._dragStartCell)for(a=this._planning.ranges.length-1;0<=a;--a)this._planning.ranges[a].day===this._dragStartCell.y&&this._planning.ranges.splice(a,1);else this._planning.ranges=[];for(e=0,s=this._o.days.length;e<s;++e)if(!this._dragStartCell||this._dragStartCell.y===e){for(l=[],i=0,n=(o=this._cellsGridArr[e]).length;i<n;++i)_=o[i],h?_.attr("data-state")!==h.s&&(""!==h.s&&(h.end=this._convertIndexToHour(i,!0),h.endIndex=i-1,h.endBlock=o[i-1],l.push(h)),h={s:t=_.attr("data-state")||this._o.stateDefault.uid,state:t?this.model_getState(t):this._o.stateDefault,day:e,start:this._convertIndexToHour(i,!1),startIndex:i,startBlock:o[i]}):h={s:t=_.attr("data-state")||this._o.stateDefault.uid,state:t?this.model_getState(t):this._o.stateDefault,day:e,start:this._convertIndexToHour(i,!1),startIndex:i,startBlock:o[i]};for(h&&""!=h.s&&(h.end=this._convertIndexToHour(i,!0),h.endIndex=n-1,h.endBlock=o[n-1],l.push(h)),h=null,this._planning.week[e]=[],a=0,r=l.length;a<r;++a)this._planning.ranges.push(l[a]),this._planning.week[e].push({s:l[a].s,start:l[a].start,end:l[a].end})}return this._planning},p._convertHourToIndex=function(t){var e=t.split(":"),s=parseInt(e[0]),o=parseInt(e[1]);return o%(60/this._o.hourParts)!=0&&(o+=1),s*this._o.hourParts+o/(60/this._o.hourParts)},p._convertIndexToHour=function(t,e){var s,o;return s=Math.floor(t/this._o.hourParts),o=60/this._o.hourParts*(t%this._o.hourParts),!0===e&&59===(o=(o-1+60)%60)&&(s-=1),s=(s=(s+24)%24).toString(),o=o.toString(),(s.length<2?"0"+s:s)+":"+(o.length<2?"0"+o:o)};
//# sourceMappingURL=map/bundle.js.map
