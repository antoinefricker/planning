var UIPlanning=function(t,n){this._domEl=$(t),this._domEl.addClass("gv-planning"),this._containerEl=this._domEl.find(".planning-container"),this._controlsEl=this._domEl.find(".planning-controls"),this._feedbackEl=this._domEl.find(".planning-feedback"),this._options=Object.assign({hourFrom:0,hourTo:24,hourParts:4,dayNames:["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],stateDefault:null,states:[]},n),this._state=null,this._rangesRenderLock=!0,this._callbacks={model_setState:this.model_setState.bind(this),ux_releaseHover:this.ux_releaseHover.bind(this),ux_columnState:this.ux_columnState.bind(this),ux_columnHover:this.ux_columnHover.bind(this),ux_rowState:this.ux_rowState.bind(this),ux_rowHover:this.ux_rowHover.bind(this),ux_blockState:this.ux_blockState.bind(this),ux_blockStateMouseState:this.ux_blockStateMouseState.bind(this)},this.dom_build(),this._allBlocks=this._containerEl.find(".uiplanning__block"),this.ux_interactions(),null!==this._options.planning?(this.model_restore(),null!==this._options.stateDefault&&this.model_setState(this._options.stateDefault)):null!==this._options.stateDefault&&(this.model_setState(this._options.stateDefault),this.dom_setBlocksState(this._allBlocks,this._state)),this._rangesRenderLock=!1,this.dom_renderRanges()};UIPlanning.prototype.ux_interactions=function(){this._containerEl.on("click",".uiplanning__day",this._callbacks.ux_rowState).on("mouseenter",".uiplanning__day",this._callbacks.ux_rowHover).on("mouseleave",".uiplanning__day",this._callbacks.ux_releaseHover).on("click",".uiplanning__hour",this._callbacks.ux_columnState).on("mouseenter",".uiplanning__hour",this._callbacks.ux_columnHover).on("mouseleave",".uiplanning__hour",this._callbacks.ux_releaseHover).on("click",".uiplanning__hour-part",this._callbacks.ux_columnState).on("mouseenter",".uiplanning__hour-part",this._callbacks.ux_columnHover).on("mouseleave",".uiplanning__hour-part",this._callbacks.ux_releaseHover).on("mousedown",".uiplanning__block",this._callbacks.ux_blockStateMouseState),this._controlsEl.on("click",".planning-state-selector",this._callbacks.model_setState)},UIPlanning.prototype.ux_displayError=function(t){this._feedbackEl.html(t)},UIPlanning.prototype.ux_blockStateMouseState=function(t){this._state?t.button&&2===t.button||("mousedown"===t.type?(this._containerEl.on("mouseenter",".uiplanning__block",this._callbacks.ux_blockState),$(document).on("mouseup dragend",this._callbacks.ux_blockStateMouseState),$(t.target).is(".uiplanning__block")&&this.ux_blockState(t)):"mouseup"===t.type&&(this._containerEl.off("mouseenter",".uiplanning__block",this._callbacks.ux_blockState),$(document).off("mouseup dragend",this._callbacks.ux_blockStateMouseState))):this.ux_displayError("no-state-selected")},UIPlanning.prototype.ux_blockState=function(t){this._state?this.dom_setBlocksState($(t.target),this._state):this.ux_displayError("no-state-selected")},UIPlanning.prototype.ux_releaseHover=function(){this._allBlocks.removeClass("uiplanning--target-hover")},UIPlanning.prototype.ux_rowSelect=function(t){return $(t.target).closest(".uiplanning-row").find(".uiplanning__block")},UIPlanning.prototype.ux_rowHover=function(t){this.ux_releaseHover(),this.ux_rowSelect(t).addClass("uiplanning--target-hover")},UIPlanning.prototype.ux_rowState=function(t){this._state?this.dom_setBlocksState(this.ux_rowSelect(t),this._state):this.ux_displayError("no-state-selected")},UIPlanning.prototype.ux_columnSelect=function(t){var n,e,o=$(t.target);if(o.is(".uiplanning__hour")){e=[];for(var s=(n=o.closest(".uiplanning-row").find(".uiplanning__hour").index(o))*this._options.hourParts,i=s+this._options.hourParts;s<i;++s)e.push(".uiplanning__block:eq("+s+")");return $(".uiplanning-row__day").find(e.join(", "))}if(o.is(".uiplanning__hour-part"))return n=o.closest(".uiplanning-row").find(".uiplanning__hour-part").index(o),$(".uiplanning-row__day").find(".uiplanning__block:eq("+n+")")},UIPlanning.prototype.ux_columnHover=function(t){this.ux_releaseHover(),this.ux_columnSelect(t).addClass("uiplanning--target-hover")},UIPlanning.prototype.ux_columnState=function(t){this._state?this.dom_setBlocksState(this.ux_columnSelect(t),this._state):this.ux_displayError("no-state-selected")},UIPlanning.prototype.dom_setBlocksState=function(t,n){t&&0!==t.length?(t.attr("data-state",n?n.uid:null),this._rangesRenderLock||this.dom_renderRanges()):console.log("no-target")},UIPlanning.prototype.dom_renderRanges=function(){var t,n,e,o,s,i=this;for(this._containerEl.find(".uiplanning__range").remove(),e=0,o=(n=this.model_retrieveRanges().ranges).length;e<o;++e)t="",t+='<div class="uiplanning__range">',t+='<div class="uiplanning__range-area"></div>',t+='<div class="uiplanning__range-tooltip">'+(s=n[e]).start+" - "+s.end+"</div>",t+="</div>",s.tipEl=$(t),s.tipEl.css({width:s.endBlock.offset().left-s.startBlock.offset().left+s.startBlock.width()}).appendTo(s.startBlock).find(".uiplanning__range-area").css({"background-color":s.state.color}),function(t){for(var n=t.startIndex;n<=t.endIndex;n++)i._cells[t.day][n].on("mouseover",function(){t.tipEl.addClass("show-tooltip")}).on("mouseout",function(){t.tipEl.removeClass("show-tooltip")})}(s)},UIPlanning.prototype.dom_build=function(){var t,n,e,o,s,i,a,l,r,_=this;for(t="",n=0,e=this._options.states.length;n<e;++n)t+='<div class="planning-state-selector" data-state="'+this._options.states[n].uid+'"><span class="bullet" style="background-color: '+this._options.states[n].color+';"></span>'+this._options.states[n].label+"</div>";for(this._controlsEl.find(".controls-selectors").append(t),t="",r=24*this._options.hourParts,t+='<div class="uiplanning-row uiplanning-row__hours">',t+="<div></div>",a=0;a<r;a++)0===(l=a%this._options.hourParts)?(t+='<div class="uiplanning__hour',0<a&&a/this._options.hourParts%6==0&&(t+=" uiplanning--hour-start-xl"),t+='">'+Math.ceil(a/this._options.hourParts)+"h"):l===this._options.hourParts-1&&(t+="</div>");for(t+="</div>",t+='<div class="uiplanning-row uiplanning-row__hour-parts">',t+="<div></div>",a=0;a<r;a++)t+='<div class="uiplanning__hour-part',0<a&&a/this._options.hourParts%6==0&&(t+=" uiplanning--hour-start-xl"),t+='"></div>';for(t+="</div>",o=0;o<7;o++){for(t+='<div class="uiplanning-row uiplanning-row__day">',t+='<div class="uiplanning__day">'+this._options.dayNames[o]+"</div>",a=0;a<r;a++)s="uiplanning__block",a%this._options.hourParts==0&&(s+=0<a&&a/this._options.hourParts%6==0?" uiplanning--hour-start-xl":" uiplanning--hour-start"),t+='<div class="'+s+'"></div>';t+="</div>"}this._containerEl.append($(t)),this._cells=[],this._containerEl.find(".uiplanning-row__day").each(function(t,n){n=$(n),i=[],n.find(".uiplanning__block").each(function(t,n){i.push($(n))}),_._cells.push(i)})},UIPlanning.prototype.model_retrieveState=function(t){if("object"==typeof t&&t.hasOwnProperty("target")&&(t=$(t.target).attr("data-state")),null===t||"string"!=typeof t)return console.log("[UIPlanning.model_setState] Unable to retrieve state from passed-in parameter: ",t),!1;for(var n=0,e=this._options.states.length;n<e;++n)if(this._options.states[n].uid===t)return this._options.states[n];return console.log("[UIPlanning.model_setState] Unable to retrieve state from UID: ",t),!1},UIPlanning.prototype.model_setState=function(t){!1!==(t=this.model_retrieveState(t))&&(this._state=t,this._controlsEl.find(".planning-state-selector").removeClass("active").filter('[data-state="'+this._state.uid+'"]').addClass("active"),this._domEl.trigger("stateSelected",{state:this._state}))},UIPlanning.prototype.model_restore=function(){var t,n,e,o,s,i,a,l,r=this._options.planning;for(null!==this._options.stateDefault&&this.dom_setBlocksState(this._allBlocks,this.model_retrieveState(this._options.stateDefault)),t=0;t<7;++t)for(n=this._containerEl.find(".uiplanning-row__day:eq("+t+")"),e=0,o=r[t].length;e<o;++e)for(s=r[t][e],i=this.model_retrieveState(s.s),a=this._convertHourToIndex(s.start),l=this._convertHourToIndex(s.end);a<l;++a)this.dom_setBlocksState(n.find(".uiplanning__block:eq("+a+")"),i);console.log("[UIPlanning.model_restore] import completed")},UIPlanning.prototype.model_export=function(){var t=this.model_retrieveRanges();return console.log("model_export",JSON.stringify(t.week)),t.week},UIPlanning.prototype.model_retrieveRanges=function(){var t,n,e,o,s,i,a,l,r,_,u={ranges:[],week:[]};for(t=0,n=this._cells.length;t<n;++t){for(r=[],i=0,a=(e=this._cells[t]).length;i<a;++i)l=e[i],_?l.attr("data-state")!==_.s&&(""!==_.s&&(_.end=this._convertIndexToHour(i,!0),_.endIndex=i-1,_.endBlock=e[i-1],r.push(_)),_={s:l.attr("data-state"),state:this.model_retrieveState(l.attr("data-state")),day:t,start:this._convertIndexToHour(i,!1),startIndex:i,startBlock:e[i]}):_={s:l.attr("data-state"),state:this.model_retrieveState(l.attr("data-state")),day:t,start:this._convertIndexToHour(i,!1),startIndex:i,startBlock:e[i]};for(_&&""!=_.s&&(_.end=this._convertIndexToHour(i,!0),_.endIndex=a-1,_.endBlock=e[a-1],r.push(_)),_=null,u.week[t]=[],o=0,s=r.length;o<s;++o)u.ranges.push(r[o]),u.week[t].push({s:r[o].s,start:r[o].start,end:r[o].end})}return u},UIPlanning.prototype._convertHourToIndex=function(t){var n=t.split(":"),e=parseInt(n[0]),o=parseInt(n[1]);return o%(60/this._options.hourParts)!=0&&(o+=1),e*this._options.hourParts+o/(60/this._options.hourParts)},UIPlanning.prototype._convertIndexToHour=function(t,n){var e,o,s;return e=Math.floor(t/this._options.hourParts),o=60/this._options.hourParts*(t%this._options.hourParts),!0===n&&59===(o=(o-1+60)%60)&&(e-=1),e=(e=(e+24)%24).toString(),o=o.toString(),s="",s+=e.length<2?"0"+e:e,s+=":",s+=o.length<2?"0"+o:o};
//# sourceMappingURL=map/bundle.js.map
